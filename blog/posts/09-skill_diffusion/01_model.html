<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Roberto Cantillan &amp; Mauricio Bucca">
<meta name="dcterms.date" content="2025-10-24">

<title>Structurally Conditioned Diffusion: A Generalized Framework for Asymmetric Trajectory Channeling in Labor Markets – Roberto Cantillan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-24c2121c465d1e416670330144b9f0c4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-b84f3661271bab6e3ce52e591ed9adc4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/bootstrap-icons-1.9.1/all.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: rgba(0, 0, 0, 0.8);
      }

      .quarto-title-block .quarto-title-banner {
        color: rgba(0, 0, 0, 0.8);
background-image: url(featured.jpg);
background-size: cover;
      }
</style>
<script src="../../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg border-bottom" data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../img/noun-small-world-network-6148828.png" alt="" class="navbar-logo light-content">
    <img src="../../../img/noun-small-world-network-6148828.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Roberto Cantillan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about/index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../talk/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../publication/index.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../project/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../resources/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rcantillan"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Structurally Conditioned Diffusion: A Generalized Framework for Asymmetric Trajectory Channeling in Labor Markets</h1>
            <p class="subtitle lead">Integrating Piecewise Diffusion Theory with Empirical Analysis of U.S. Skills Data (2015-2023)</p>
                                <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Diffusion Theory</div>
                <div class="quarto-category">Polarization</div>
                <div class="quarto-category">Stratification</div>
                <div class="quarto-category">Inequality</div>
                <div class="quarto-category">Labor Markets</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Roberto Cantillan &amp; Mauricio Bucca </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Department of Sociology, PUC
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 24, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">in this page</h2>
   
  <ul>
  <li><a href="#introduction-from-employer-decisions-to-labor-market-structure" id="toc-introduction-from-employer-decisions-to-labor-market-structure" class="nav-link active" data-scroll-target="#introduction-from-employer-decisions-to-labor-market-structure">Introduction: From Employer Decisions to Labor Market Structure</a></li>
  <li><a href="#theoretical-foundations-from-mimicry-to-meaning" id="toc-theoretical-foundations-from-mimicry-to-meaning" class="nav-link" data-scroll-target="#theoretical-foundations-from-mimicry-to-meaning">Theoretical Foundations: From Mimicry to Meaning</a>
  <ul class="collapse">
  <li><a href="#the-micro-foundations-of-imitation" id="toc-the-micro-foundations-of-imitation" class="nav-link" data-scroll-target="#the-micro-foundations-of-imitation">The Micro-Foundations of Imitation</a></li>
  <li><a href="#a-dual-process-theory-of-skill-diffusion-the-role-of-theorization" id="toc-a-dual-process-theory-of-skill-diffusion-the-role-of-theorization" class="nav-link" data-scroll-target="#a-dual-process-theory-of-skill-diffusion-the-role-of-theorization">A Dual-Process Theory of Skill Diffusion: The Role of Theorization</a></li>
  <li><a href="#piecewise-dual-process-diffusion-model" id="toc-piecewise-dual-process-diffusion-model" class="nav-link" data-scroll-target="#piecewise-dual-process-diffusion-model">Piecewise Dual Process Diffusion Model</a>
  <ul class="collapse">
  <li><a href="#mathematical-formulation" id="toc-mathematical-formulation" class="nav-link" data-scroll-target="#mathematical-formulation">Mathematical Formulation</a></li>
  <li><a href="#advantages-of-the-piecewise-specification" id="toc-advantages-of-the-piecewise-specification" class="nav-link" data-scroll-target="#advantages-of-the-piecewise-specification">Advantages of the Piecewise Specification</a></li>
  <li><a href="#curved-piecewise-extension" id="toc-curved-piecewise-extension" class="nav-link" data-scroll-target="#curved-piecewise-extension">Curved Piecewise Extension</a></li>
  <li><a href="#prior-choices-rationale" id="toc-prior-choices-rationale" class="nav-link" data-scroll-target="#prior-choices-rationale">Prior Choices: Rationale</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#empirical-analysis" id="toc-empirical-analysis" class="nav-link" data-scroll-target="#empirical-analysis">Empirical Analysis</a>
  <ul class="collapse">
  <li><a href="#data-and-setup" id="toc-data-and-setup" class="nav-link" data-scroll-target="#data-and-setup">Data and Setup</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#variable-construction" id="toc-variable-construction" class="nav-link" data-scroll-target="#variable-construction">Variable Construction</a></li>
  <li><a href="#descriptive-analysis" id="toc-descriptive-analysis" class="nav-link" data-scroll-target="#descriptive-analysis">Descriptive Analysis</a></li>
  <li><a href="#descriptive-visualizations" id="toc-descriptive-visualizations" class="nav-link" data-scroll-target="#descriptive-visualizations">Descriptive Visualizations</a></li>
  </ul></li>
  <li><a href="#model-specification-and-estimation" id="toc-model-specification-and-estimation" class="nav-link" data-scroll-target="#model-specification-and-estimation">Model Specification and Estimation</a>
  <ul class="collapse">
  <li><a href="#piecewise-dual-process-models" id="toc-piecewise-dual-process-models" class="nav-link" data-scroll-target="#piecewise-dual-process-models">Piecewise Dual Process Models</a></li>
  <li><a href="#separate-model-estimation" id="toc-separate-model-estimation" class="nav-link" data-scroll-target="#separate-model-estimation">Separate Model Estimation</a></li>
  <li><a href="#parameter-extraction-and-comparison" id="toc-parameter-extraction-and-comparison" class="nav-link" data-scroll-target="#parameter-extraction-and-comparison">Parameter Extraction and Comparison</a></li>
  </ul></li>
  <li><a href="#statistical-tests-and-model-comparison" id="toc-statistical-tests-and-model-comparison" class="nav-link" data-scroll-target="#statistical-tests-and-model-comparison">Statistical Tests and Model Comparison</a>
  <ul class="collapse">
  <li><a href="#model-predictions-visualization" id="toc-model-predictions-visualization" class="nav-link" data-scroll-target="#model-predictions-visualization">Model Predictions &amp; Visualization</a></li>
  </ul></li>
  <li><a href="#advanced-bayesian-analysis-with-curvature-selection" id="toc-advanced-bayesian-analysis-with-curvature-selection" class="nav-link" data-scroll-target="#advanced-bayesian-analysis-with-curvature-selection">Advanced Bayesian Analysis (with Curvature Selection)</a></li>
  <li><a href="#fixed-effects-causal-analysis-controlling-for-unobserved-heterogeneity" id="toc-fixed-effects-causal-analysis-controlling-for-unobserved-heterogeneity" class="nav-link" data-scroll-target="#fixed-effects-causal-analysis-controlling-for-unobserved-heterogeneity">Fixed Effects Causal Analysis: Controlling for Unobserved Heterogeneity</a>
  <ul class="collapse">
  <li><a href="#fixed-effects-model-specification" id="toc-fixed-effects-model-specification" class="nav-link" data-scroll-target="#fixed-effects-model-specification">Fixed Effects Model Specification</a></li>
  <li><a href="#fixed-effects-model-estimation" id="toc-fixed-effects-model-estimation" class="nav-link" data-scroll-target="#fixed-effects-model-estimation">Fixed Effects Model Estimation</a></li>
  <li><a href="#fixed-effects-results-and-significance-testing" id="toc-fixed-effects-results-and-significance-testing" class="nav-link" data-scroll-target="#fixed-effects-results-and-significance-testing">Fixed Effects Results and Significance Testing</a></li>
  <li><a href="#fixed-effects-analysis-interpretation" id="toc-fixed-effects-analysis-interpretation" class="nav-link" data-scroll-target="#fixed-effects-analysis-interpretation">Fixed Effects Analysis Interpretation</a></li>
  <li><a href="#fixed-effects-visualization" id="toc-fixed-effects-visualization" class="nav-link" data-scroll-target="#fixed-effects-visualization">Fixed Effects Visualization</a></li>
  <li><a href="#fixed-effects-model-robustness" id="toc-fixed-effects-model-robustness" class="nav-link" data-scroll-target="#fixed-effects-model-robustness">Fixed Effects Model Robustness</a></li>
  </ul></li>
  <li><a href="#discussion-the-stratification-engine" id="toc-discussion-the-stratification-engine" class="nav-link" data-scroll-target="#discussion-the-stratification-engine">Discussion: The Stratification Engine</a></li>
  <li><a href="#conclusions-and-future-directions" id="toc-conclusions-and-future-directions" class="nav-link" data-scroll-target="#conclusions-and-future-directions">Conclusions and Future Directions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction-from-employer-decisions-to-labor-market-structure" class="level1">
<h1>Introduction: From Employer Decisions to Labor Market Structure</h1>
<p>The architecture of inequality in the U.S. labor market is not a static blueprint but an actively reproduced, dynamic process. Its foundations lie in the everyday decisions of <strong>employers within organizations</strong>, who determine which skill requirements to establish for the occupations they manage. Foundational studies have demonstrated that the skill landscape itself is starkly polarized into two distinct domains—a socio-cognitive cluster associated with high wages and a sensory-physical one with low wages <span class="citation" data-cites="alabdulkareem_unpacking_2018">(<a href="#ref-alabdulkareem_unpacking_2018" role="doc-biblioref">Alabdulkareem et al. 2018</a>)</span>—and that this space has a nested, hierarchical architecture <span class="citation" data-cites="hosseinioun_skill_2025">(<a href="#ref-hosseinioun_skill_2025" role="doc-biblioref">Hosseinioun et al. 2025</a>)</span>. This structural view aligns with recent findings in intergenerational mobility research, which conceptualize occupations not as monolithic categories but as complex bundles of gradational characteristics, where it is often the underlying traits, rather than the job title itself, that are transmitted across generations <span class="citation" data-cites="york_gradationalism_2025">(<a href="#ref-york_gradationalism_2025" role="doc-biblioref">York, Song, and Xie 2025</a>)</span>.</p>
<p>Faced with uncertainty about which skill requirements will maximize productivity or prestige, employers often look to the practices of <strong>other organizations</strong> for guidance. They engage in a process of social learning and imitation, observing how similar organizations define skill requirements for comparable occupations. However, we argue this imitation is not random. It is governed by a powerful, yet poorly understood, mechanism of asymmetric filtering based on the <strong>cultural theorization</strong> of the skill itself. The nature of a skill—how it is socially interpreted and valued—fundamentally alters the pathways it can travel across the occupational status hierarchy as organizations adopt and adapt these requirements.</p>
<p>The cumulative result of thousands of these guided, micro-level imitation decisions is a macro-level process we term <strong>Asymmetric Trajectory Channeling</strong>. This process actively sorts skills into divergent mobility paths—an upward “escalator” for cognitive skills and a “containment field” for physical ones—thus deepening labor market stratification from the demand side.</p>
<p>This study moves beyond describing the consequences of polarization for workers (the supply side) to model the causal mechanisms on the demand side that generate it. By focusing on the rules that guide employer imitation <strong>between organizations</strong>, we explain how structural inequality is not merely a state, but an emergent process reproduced from the ground up through organizational decision-making.</p>
</section>
<section id="theoretical-foundations-from-mimicry-to-meaning" class="level1">
<h1>Theoretical Foundations: From Mimicry to Meaning</h1>
<p>Early studies of diffusion often focused on the spread of a single innovation through a homogenous population. More recent work, however, recognizes that diffusion is fundamentally structured by networks and heterogeneity. Practices do not diffuse randomly or uniformly; they follow patterned trajectories shaped by organizational, cultural, and institutional constraints <span class="citation" data-cites="strang_diffusion_1998">(<a href="#ref-strang_diffusion_1998" role="doc-biblioref">Strang and Soule 1998</a>)</span>.</p>
<section id="the-micro-foundations-of-imitation" class="level2">
<h2 class="anchored" data-anchor-id="the-micro-foundations-of-imitation">The Micro-Foundations of Imitation</h2>
<p>We extend this insight by arguing that <strong>employers imitate skill requirements according to fundamentally different logics depending on the type of skill in question</strong>. To understand why, we must first examine the micro-foundations of organizational imitation. The literature suggests three key mechanisms that drive one organization to adopt the practices of another:</p>
<ol type="1">
<li><p><strong>Uncertainty and Bounded Rationality:</strong> Under conditions of uncertainty about the relationship between means and ends, organizations often imitate others as a decision-making shortcut. Rather than calculating an optimal solution from scratch, imitation offers a viable solution with reduced search costs <span class="citation" data-cites="cyert_behavioral_2006 dimaggio_iron_1983">(<a href="#ref-cyert_behavioral_2006" role="doc-biblioref">Cyert, Cyert, and March 2006</a>; <a href="#ref-dimaggio_iron_1983" role="doc-biblioref">DiMaggio and Powell 1983</a>)</span>.</p></li>
<li><p><strong>Prestige and Status-Seeking:</strong> Imitation is not just a response to uncertainty, but also a strategy to gain legitimacy and status. Organizations do not imitate just anyone; they emulate those they perceive to be more successful or prestigious <span class="citation" data-cites="strang_search_2001 bail_prestige_2019">(<a href="#ref-strang_search_2001" role="doc-biblioref">Strang and Macy 2001</a>; <a href="#ref-bail_prestige_2019" role="doc-biblioref">Bail, Brown, and Wimmer 2019</a>)</span>. This process of “adaptive emulation” <span class="citation" data-cites="strang_search_2001">(<a href="#ref-strang_search_2001" role="doc-biblioref">Strang and Macy 2001</a>)</span>, driven by “success stories,” creates an inherent directional bias in diffusion, where practices flow from high-status to low-status actors.</p></li>
<li><p><strong>Proximity and Network Structure:</strong> Influence is not global but is channeled through social and structural networks. The likelihood that one organization imitates another is strongly conditioned by proximity, whether geographic, social, or cultural <span class="citation" data-cites="hedstrom_contagious_1994 strang_spatial_1993">(<a href="#ref-hedstrom_contagious_1994" role="doc-biblioref">Hedström 1994</a>; <a href="#ref-strang_spatial_1993" role="doc-biblioref">Strang and Tuma 1993</a>)</span>. Actors are more influenced by their peers, direct competitors, or those with whom they maintain dense relationships.</p></li>
</ol>
</section>
<section id="a-dual-process-theory-of-skill-diffusion-the-role-of-theorization" class="level2">
<h2 class="anchored" data-anchor-id="a-dual-process-theory-of-skill-diffusion-the-role-of-theorization">A Dual-Process Theory of Skill Diffusion: The Role of Theorization</h2>
<p>Our key theoretical innovation is that the <strong>content</strong> of a skill—how it is culturally <strong>theorized</strong> <span class="citation" data-cites="strang_institutional_1993">(<a href="#ref-strang_institutional_1993" role="doc-biblioref">Strang and Meyer 1993</a>)</span>—determines which of these micro-foundations becomes dominant. We argue that organizations filter and evaluate potential practices through two qualitatively different diffusion logics:</p>
<ul>
<li><p><strong>Cognitive Skills as Portable Assets:</strong> Cognitive skills (analytical, interpersonal, managerial) are theorized as <strong>nested capabilities</strong>: they are abstract, broadly applicable, and perceived as portable assets associated with growth, learning, and adaptability. Under uncertainty, employers look toward <strong>prestigious exemplars</strong> <span class="citation" data-cites="strang_learning_2010">(<a href="#ref-strang_learning_2010" role="doc-biblioref">Strang 2010</a>)</span> that signal success and modernity. As a result, the diffusion of cognitive skills is driven primarily by <strong>aspirational emulation</strong>. They tend to diffuse <strong>upward</strong> through the occupational status hierarchy as organizations seek to imitate their high-status peers.</p></li>
<li><p><strong>Physical Skills as Context-Dependent Competencies:</strong> In contrast, physical skills (manual, motor) are theorized as <strong>context-dependent competencies</strong>: they are tied to specific material settings, bodily execution, and legacy institutional constraints. They are less likely to be read as generalizable templates for upward mobility. Instead, their diffusion is based on functional rather than aspirational considerations. Therefore, the diffusion of physical skills is governed mainly by <strong>proximity and functional need</strong>, showing less directional bias or even <strong>containment effects</strong> within their current status segments.</p></li>
</ul>
<p>This bifurcation in diffusion logics is what we call <strong>Asymmetric Trajectory Channeling</strong>. While our model, for analytical clarity, uses a binary distinction, we treat skills as <strong>multidimensional bundles</strong> of traits, values, and dispositions <span class="citation" data-cites="york_gradationalism_2025">(<a href="#ref-york_gradationalism_2025" role="doc-biblioref">York, Song, and Xie 2025</a>)</span>. Employers imitate not just individual skills, but <strong>pieces of occupational identity</strong>.</p>
</section>
<section id="piecewise-dual-process-diffusion-model" class="level2">
<h2 class="anchored" data-anchor-id="piecewise-dual-process-diffusion-model">Piecewise Dual Process Diffusion Model</h2>
<p>To formalize these dynamics while avoiding multicollinearity issues, we model the <strong>probability</strong> (<span class="math inline">\(P_{i \to j}^{(c)}\)</span>) that an employer, managing a target occupation <span class="math inline">\(j\)</span>, adopts a skill of class <span class="math inline">\(c\)</span> by imitating a requirement from a source occupation <span class="math inline">\(i\)</span>. This decision is embedded in the macro-level structure of the occupational space.</p>
<section id="mathematical-formulation" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-formulation">Mathematical Formulation</h3>
<p>We define two <strong>non-overlapping</strong> directional status variables that completely separate upward and downward mobility:</p>
<p><span class="math display">\[
\Delta^+_{ij} = \max(0, s_j - s_i) \quad \text{(upward status shift)}
\]</span></p>
<p><span class="math display">\[
\Delta^-_{ij} = \max(0, s_i - s_j) \quad \text{(downward status shift)}
\]</span></p>
<p>The structural form of our <strong>Piecewise Dual Process Model</strong> expresses the diffusion likelihood as:</p>
<p><span class="math display">\[
\text{logit}\, P_{i \to j}^{(c)} = \theta_{0c} - \lambda_c d_{ij} - \beta_c^+ \Delta^+_{ij} - \beta_c^- \Delta^-_{ij} - \omega_c w_{ij}
\]</span></p>
<p>Where: - <span class="math inline">\(\theta_{0c}\)</span>: baseline propensity to adopt skill class <span class="math inline">\(c\)</span> - <span class="math inline">\(\lambda_c\)</span>: structural distance penalty parameter - <span class="math inline">\(\beta_c^+\)</span>: penalty (or bonus) per unit <strong>upward</strong> status move - <span class="math inline">\(\beta_c^-\)</span>: penalty (or bonus) per unit <strong>downward</strong> status move - <span class="math inline">\(\omega_c\)</span>: coefficient for wage gap control <span class="math inline">\(w_{ij}\)</span></p>
</section>
<section id="advantages-of-the-piecewise-specification" class="level3">
<h3 class="anchored" data-anchor-id="advantages-of-the-piecewise-specification">Advantages of the Piecewise Specification</h3>
<ol type="1">
<li><strong>Eliminates Multicollinearity</strong>: Unlike models using both <span class="math inline">\((s_j - s_i)\)</span> and <span class="math inline">\(|s_j - s_i|\)</span>, our piecewise variables are mathematically orthogonal since <span class="math inline">\(\Delta^+_{ij} \cdot \Delta^-_{ij} = 0\)</span> always.</li>
<li><strong>Direct Asymmetry Testing</strong>: The difference <span class="math inline">\((\beta_c^+ - \beta_c^-)\)</span> directly measures directional asymmetry without requiring complex transformations.</li>
<li><strong>Clear Interpretation</strong>: Each parameter has an unambiguous meaning tied to specific types of status moves.</li>
</ol>
</section>
<section id="curved-piecewise-extension" class="level3">
<h3 class="anchored" data-anchor-id="curved-piecewise-extension">Curved Piecewise Extension</h3>
<p>For situations where we expect <strong>nonlinear sensitivity</strong> to status differences, the model can be extended to include curvature terms. We estimate a <strong>generalized linear model</strong> with a <strong>Bernoulli likelihood</strong> and <strong>logit link</strong>. The outcome <span class="math inline">\(y_{ij}^{(c)} \in \{0, 1\}\)</span> indicates whether occupation <span class="math inline">\(j\)</span> adopts a skill of class <span class="math inline">\(c\)</span> from occupation <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[
y_{ij}^{(c)} \sim \text{Bernoulli}(p_{ij}^{(c)}), \quad \text{logit}(p_{ij}^{(c)}) = \eta_{ij}^{(c)}
\]</span></p>
<p>The predictor is a <strong>second-order polynomial expansion</strong> of upward and downward status gaps:</p>
<p><span class="math display">\[
\eta_{ij}^{(c)} =
\theta_{0c}
- \lambda_c d_{ij}
- \beta_{1c}^+ \Delta^+_{ij}
- \beta_{2c}^+ (\Delta^+_{ij})^2
- \beta_{1c}^- \Delta^-_{ij}
- \beta_{2c}^- (\Delta^-_{ij})^2
\]</span></p>
</section>
<section id="prior-choices-rationale" class="level3">
<h3 class="anchored" data-anchor-id="prior-choices-rationale">Prior Choices: Rationale</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
<th>Prior</th>
<th>Justification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\theta_{0c}\)</span> (intercept)</td>
<td>Baseline adoption tendency</td>
<td><code>normal(0, 5)</code></td>
<td>Nearly uninformative; wide enough for coverage</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\lambda_c\)</span>, <span class="math inline">\(\beta_{1c}^{\pm}\)</span></td>
<td>Main distance and status slope terms</td>
<td><code>normal(0, 1)</code></td>
<td>Weakly informative; encourages shrinkage</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\beta_{2c}^{\pm}\)</span></td>
<td>Curvature terms (quadratic effects)</td>
<td><code>double_exponential(0, 0.5)</code></td>
<td><strong>Lasso-type prior</strong> to enable variable selection</td>
</tr>
</tbody>
</table>
<p>The <strong>double-exponential (or Laplace) prior</strong> places more mass near 0 than the normal, encouraging sparsity in curvature terms (i.e., it can shrink them toward zero). This is helpful if you’re unsure whether curvature is really needed.</p>
<p><a href="plot_intro.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="plot_intro.png" class="img-fluid"></a></p>
</section>
</section>
</section>
<section id="empirical-analysis" class="level1">
<h1>Empirical Analysis</h1>
<section id="data-and-setup" class="level2">
<h2 class="anchored" data-anchor-id="data-and-setup">Data and Setup</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(data.table)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(broom)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(scales)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(lmtest)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(knitr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggrepel)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(viridis)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggtext)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(brms)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(fixest)  <span class="co"># For fixed effects models</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom theme for a professional, academic look</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>theme_paper <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">15</span>, <span class="at">base_family =</span> <span class="st">"sans"</span>) { </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> base_size, <span class="at">base_family =</span> base_family) <span class="sc">+</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey20"</span>),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>), <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>), <span class="at">family =</span> base_family), </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.1</span>), <span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>), <span class="at">lineheight =</span> <span class="fl">1.2</span>), </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.9</span>), <span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">12</span>)), </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>), <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>), </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.1</span>), <span class="at">color =</span> <span class="st">"grey40"</span>), </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey93"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.15</span>), <span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.05</span>)), </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"grey90"</span>),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>), <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"grey20"</span>), </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey97"</span>, <span class="at">color =</span> <span class="st">"grey80"</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_paper</span>())</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a consistent color palette</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Socio-cognitive"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"Socio-technical"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>output_dir <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Stratified_Diffusion_Analysis_"</span>, <span class="fu">Sys.Date</span>())</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(output_dir)) <span class="fu">dir.create</span>(output_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>comma <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">big.mark =</span> <span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust data loading function</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>load_and_prepare_data <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> <span class="st">"/home/rober/Descargas/all_events_final_enriched.RData"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(data_path)) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">load</span>(data_path)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"all_events_final_enriched"</span>)) {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      data_for_models <span class="ot">&lt;-</span> all_events_final_enriched</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Successfully loaded 'all_events_final_enriched'."</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Warning: 'all_events_final_enriched' not found. Searching for another suitable data object."</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      all_objs <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      suitable_objects <span class="ot">&lt;-</span> all_objs[<span class="fu">sapply</span>(all_objs, <span class="cf">function</span>(x) {</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        obj <span class="ot">&lt;-</span> <span class="fu">get</span>(x)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">is.data.frame</span>(obj) <span class="sc">||</span> <span class="fu">is.data.table</span>(obj)) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(obj) <span class="sc">&gt;</span> <span class="dv">1000</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      })]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(suitable_objects) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        data_for_models <span class="ot">&lt;-</span> <span class="fu">get</span>(suitable_objects[<span class="dv">1</span>])</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Using fallback data object:"</span>, suitable_objects[<span class="dv">1</span>]))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"No suitable data object found."</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"Data file not found at path:"</span>, data_path))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data_for_models)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>data_for_models <span class="ot">&lt;-</span> <span class="fu">load_and_prepare_data</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="variable-construction" class="level2">
<h2 class="anchored" data-anchor-id="variable-construction">Variable Construction</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust variable mapping - UPDATED TO USE distance_euclidean_rca consistently</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>available_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(data_for_models)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>required_mapping <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">diffusion =</span> <span class="fu">c</span>(<span class="st">"diffusion"</span>, <span class="st">"adopt"</span>, <span class="st">"adoption"</span>, <span class="st">"outcome"</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">structural_distance =</span> <span class="fu">c</span>(<span class="st">"distance_euclidean_rca"</span>, <span class="st">"structural_distance"</span>, <span class="st">"dist"</span>, <span class="st">"distance"</span>, <span class="st">"d_ij"</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">status_diff =</span> <span class="fu">c</span>(<span class="st">"education_diff_abs"</span>, <span class="st">"status_gap_signed"</span>, <span class="st">"education_diff"</span>, <span class="st">"status_diff"</span>, <span class="st">"edu_diff"</span>, <span class="st">"status_gap"</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage_diff =</span> <span class="fu">c</span>(<span class="st">"wage_diff_abs"</span>, <span class="st">"wage_gap"</span>, <span class="st">"wage_diff"</span>, <span class="st">"wage_distance"</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">skill_group =</span> <span class="fu">c</span>(<span class="st">"skill_group_for_model"</span>, <span class="st">"skill_group"</span>, <span class="st">"cluster"</span>, <span class="st">"group"</span>, <span class="st">"LeidenCluster_2015"</span>, <span class="st">"skill_cluster_type"</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">source_education =</span> <span class="fu">c</span>(<span class="st">"source_education"</span>, <span class="st">"edu_i"</span>, <span class="st">"source_edu"</span>, <span class="st">"soc_source"</span>, <span class="st">"education_source"</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_education =</span> <span class="fu">c</span>(<span class="st">"target_education"</span>, <span class="st">"edu_j"</span>, <span class="st">"target_edu"</span>, <span class="st">"soc_target"</span>, <span class="st">"education_target"</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">source_wage =</span> <span class="fu">c</span>(<span class="st">"source_wage"</span>, <span class="st">"wage_i"</span>, <span class="st">"wage_source"</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_wage =</span> <span class="fu">c</span>(<span class="st">"target_wage"</span>, <span class="st">"wage_j"</span>, <span class="st">"wage_target"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>column_matches <span class="ot">&lt;-</span> <span class="fu">sapply</span>(required_mapping, <span class="cf">function</span>(p_names) {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  found <span class="ot">&lt;-</span> <span class="fu">intersect</span>(p_names, available_cols)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(found) <span class="sc">&gt;</span> <span class="dv">0</span>) found[<span class="dv">1</span>] <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for essential columns</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>essential_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"diffusion"</span>, <span class="st">"structural_distance"</span>, <span class="st">"status_diff"</span>, <span class="st">"skill_group"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(column_matches[essential_cols]))) {</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  missing_essentials <span class="ot">&lt;-</span> <span class="fu">names</span>(column_matches[essential_cols][<span class="fu">is.na</span>(column_matches[essential_cols])])</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"Missing essential columns for model:"</span>, <span class="fu">paste</span>(missing_essentials, <span class="at">collapse=</span><span class="st">", "</span>)))</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.data.table</span>(data_for_models)) {</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  data_for_models <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(data_for_models)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>generalized_data <span class="ot">&lt;-</span> <span class="fu">copy</span>(data_for_models)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create variables for the model - USING distance_euclidean_rca consistently</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>generalized_data[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">diffusion =</span> <span class="fu">as.numeric</span>(<span class="fu">get</span>(column_matches[[<span class="st">"diffusion"</span>]])),</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_ij =</span> <span class="fu">as.numeric</span>(<span class="fu">get</span>(column_matches[[<span class="st">"structural_distance"</span>]])),  <span class="co"># This will be distance_euclidean_rca</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">status_gap_signed =</span> <span class="fu">as.numeric</span>(<span class="fu">get</span>(column_matches[[<span class="st">"status_diff"</span>]])),</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">skill_group_for_model =</span> <span class="fu">as.character</span>(<span class="fu">get</span>(column_matches[[<span class="st">"skill_group"</span>]]))</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create piecewise variables</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>generalized_data[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">delta_up =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, status_gap_signed),      <span class="co"># Δ⁺: upward movements</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">delta_down =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="sc">-</span>status_gap_signed),  <span class="co"># Δ⁻: downward movements</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">status_gap_magnitude =</span> <span class="fu">abs</span>(status_gap_signed)  <span class="co"># Keep for compatibility</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle wage_gap column</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"wage_diff_abs"</span> <span class="sc">%in%</span> <span class="fu">names</span>(generalized_data)) {</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  generalized_data[, wage_gap <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(wage_diff_abs)]</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Using 'wage_diff_abs' for wage_gap."</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(column_matches[[<span class="st">"wage_diff"</span>]])) {</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  generalized_data[, wage_gap <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">get</span>(column_matches[[<span class="st">"wage_diff"</span>]]))]</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Warning: 'wage_diff' column not found. Creating a dummy 'wage_gap' column."</span>)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  generalized_data[, wage_gap <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span>]</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Add source/target variables</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"source_Edu_Score_Weighted"</span>, <span class="st">"target_Edu_Score_Weighted"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(generalized_data))) {</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  generalized_data[, source_edu <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(source_Edu_Score_Weighted)]</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  generalized_data[, target_edu <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(target_Edu_Score_Weighted)]</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Using 'source_Edu_Score_Weighted' and 'target_Edu_Score_Weighted' for education variables."</span>)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"source_Median_Wage_2015"</span>, <span class="st">"target_Median_Wage_2023"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(generalized_data))) {</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  generalized_data[, source_wage <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(source_Median_Wage_2015)]</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  generalized_data[, target_wage <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(target_Median_Wage_2023)]</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Using 'source_Median_Wage_2015' and 'target_Median_Wage_2023' for wage variables."</span>)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign content type based on skill group</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"LeidenCluster_2015"</span> <span class="sc">%in%</span> <span class="fu">names</span>(generalized_data)) {</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Applying specific corrections to 'LeidenCluster_2015' as per original script."</span>)</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    generalized_data[, LeidenCluster_2015 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.character</span>(LeidenCluster_2015)]</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    generalized_data[LeidenCluster_2015 <span class="sc">==</span> <span class="st">"NoCluster_2015"</span>, LeidenCluster_2015 <span class="sc">:</span><span class="er">=</span> <span class="st">"LeidenC_1"</span>]</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    generalized_data <span class="ot">&lt;-</span> generalized_data[LeidenCluster_2015 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LeidenC_1"</span>, <span class="st">"LeidenC_2"</span>)]</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    generalized_data[, content_type <span class="sc">:</span><span class="er">=</span> <span class="fu">fifelse</span>(LeidenCluster_2015 <span class="sc">==</span> <span class="st">"LeidenC_1"</span>, <span class="st">"Socio-cognitive"</span>, <span class="st">"Socio-technical"</span>)]</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Warning: 'LeidenCluster_2015' not found. Using generic classification."</span>)</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    unique_skill_groups <span class="ot">&lt;-</span> <span class="fu">unique</span>(generalized_data<span class="sc">$</span>skill_group_for_model)</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    groups_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(unique_skill_groups)</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    enhancing_groups <span class="ot">&lt;-</span> <span class="fu">head</span>(groups_sorted, <span class="fu">length</span>(groups_sorted) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    generalized_data[, content_type <span class="sc">:</span><span class="er">=</span> <span class="fu">fifelse</span>(skill_group_for_model <span class="sc">%in%</span> enhancing_groups, </span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Socio-cognitive"</span>, <span class="st">"Socio-technical"</span>)]</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Final data cleaning</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>generalized_data <span class="ot">&lt;-</span> generalized_data[<span class="sc">!</span><span class="fu">is.na</span>(content_type)]</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>generalized_data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(generalized_data, </span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>                                <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"diffusion"</span>, <span class="st">"d_ij"</span>, <span class="st">"delta_up"</span>, <span class="st">"delta_down"</span>, <span class="st">"wage_gap"</span>))</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify piecewise variables</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"Created piecewise variables: delta_up (mean=%.3f), delta_down (mean=%.3f)"</span>, </span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mean</span>(generalized_data<span class="sc">$</span>delta_up), <span class="fu">mean</span>(generalized_data<span class="sc">$</span>delta_down)))</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Fragment data</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>cognitive_data <span class="ot">&lt;-</span> generalized_data[content_type <span class="sc">==</span> <span class="st">"Socio-cognitive"</span>]</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>physical_data <span class="ot">&lt;-</span> generalized_data[content_type <span class="sc">==</span> <span class="st">"Socio-technical"</span>]</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Report which distance variable is being used</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>distance_var_used <span class="ot">&lt;-</span> column_matches[[<span class="st">"structural_distance"</span>]]</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"Using '%s' as structural distance variable across all analyses."</span>, distance_var_used))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="descriptive-analysis" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-analysis">Descriptive Analysis</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>desc_stats <span class="ot">&lt;-</span> generalized_data[, .(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">comma</span>(.N),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Diffusion_Rate =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, <span class="fu">mean</span>(diffusion, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_Distance =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, <span class="fu">mean</span>(d_ij, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_Upward_Shift =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, <span class="fu">mean</span>(delta_up, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean_Downward_Shift =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, <span class="fu">mean</span>(delta_down, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Upward_Diffusion_Rate =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, <span class="fu">mean</span>(diffusion[delta_up <span class="sc">&gt;</span> <span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Downward_Diffusion_Rate =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, <span class="fu">mean</span>(diffusion[delta_down <span class="sc">&gt;</span> <span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>), by <span class="ot">=</span> content_type]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(desc_stats, </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"**Table 1: Descriptive Statistics by Skill Content Type**"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Content Type"</span>, <span class="st">"N"</span>, <span class="st">"Diffusion Rate"</span>, <span class="st">"Mean Distance"</span>, </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Mean Δ⁺"</span>, <span class="st">"Mean Δ⁻"</span>, <span class="st">"Upward Diffusion"</span>, <span class="st">"Downward Diffusion"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>**Table 1: Descriptive Statistics by Skill Content Type**</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Content Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">N</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Diffusion Rate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mean Distance</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mean Δ⁺</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mean Δ⁻</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Upward Diffusion</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Downward Diffusion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Socio-cognitive</td>
<td style="text-align: left;">353,988</td>
<td style="text-align: left;">26.8%</td>
<td style="text-align: left;">0.679</td>
<td style="text-align: left;">1.161</td>
<td style="text-align: left;">0.773</td>
<td style="text-align: left;">37.5%</td>
<td style="text-align: left;">13.6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Socio-technical</td>
<td style="text-align: left;">318,951</td>
<td style="text-align: left;">27.0%</td>
<td style="text-align: left;">0.675</td>
<td style="text-align: left;">1.512</td>
<td style="text-align: left;">0.294</td>
<td style="text-align: left;">27.0%</td>
<td style="text-align: left;">27.1%</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Table 1 Interpretation:</strong> This table summarizes the key variables for the two skill types. We observe that socio-cognitive skills have a slightly higher overall diffusion rate. Notably, for both types, the diffusion rate is higher for upward status shifts (Δ⁺ &gt; 0) than for downward shifts (Δ⁻ &gt; 0), providing initial evidence of an aspirational bias in skill adoption.</p>
</section>
<section id="descriptive-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-visualizations">Descriptive Visualizations</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>create_descriptive_coherent_style <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Trabajar con data.table</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.data.table</span>(data)) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(data)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    dt <span class="ot">&lt;-</span> <span class="fu">copy</span>(data)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verificar columnas</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"status_gap_signed"</span>, <span class="st">"content_type"</span>, <span class="st">"diffusion"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  missing_cols <span class="ot">&lt;-</span> required_cols[<span class="sc">!</span>required_cols <span class="sc">%in%</span> <span class="fu">names</span>(dt)]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_cols) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Missing required columns: "</span>, <span class="fu">paste</span>(missing_cols, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear movement_type</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  dt[, movement_type <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    status_gap_signed <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="st">"Downward"</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abs</span>(status_gap_signed) <span class="sc">&lt;=</span> <span class="fl">0.5</span>, <span class="st">"Lateral"</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    status_gap_signed <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Upward"</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">default =</span> <span class="cn">NA_character_</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  )]</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtrar datos válidos</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  dt_clean <span class="ot">&lt;-</span> dt[<span class="sc">!</span><span class="fu">is.na</span>(movement_type) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(content_type)]</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular estadísticas</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  summary_stats <span class="ot">&lt;-</span> dt_clean[, .(</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">diffusion_rate =</span> <span class="fu">mean</span>(diffusion, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> .N</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  ), by <span class="ot">=</span> .(movement_type, content_type)]</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular intervalos de confianza</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  summary_stats[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="fu">sqrt</span>(diffusion_rate <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> diffusion_rate) <span class="sc">/</span> n),</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, diffusion_rate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sqrt</span>(diffusion_rate <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> diffusion_rate) <span class="sc">/</span> n)),</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> <span class="fu">pmin</span>(<span class="dv">1</span>, diffusion_rate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sqrt</span>(diffusion_rate <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> diffusion_rate) <span class="sc">/</span> n))</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  )]</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir a data.frame y ordenar</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  summary_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(summary_stats)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  summary_df<span class="sc">$</span>movement_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(summary_df<span class="sc">$</span>movement_type, </span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Downward"</span>, <span class="st">"Lateral"</span>, <span class="st">"Upward"</span>))</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mismos colores que el plot de líneas</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  coherent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Socio-cognitive"</span> <span class="ot">=</span> <span class="st">"#1f77b4"</span>,  <span class="co"># Azul coherente</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Socio-technical"</span> <span class="ot">=</span> <span class="st">"#ff7f0e"</span>   <span class="co"># Naranja coherente</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear el plot con el mismo estilo</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(summary_df, <span class="fu">aes</span>(<span class="at">x =</span> movement_type, <span class="at">y =</span> diffusion_rate, <span class="at">fill =</span> content_type)) <span class="sc">+</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Área sombreada sutil para destacar el escalator effect</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">2.5</span>, <span class="at">xmax =</span> <span class="fl">3.5</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"#E8F4FD"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Azul muy claro</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Barras principales</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.8</span>), </span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>             <span class="at">width =</span> <span class="fl">0.7</span>,</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.8</span>,</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Barras de error elegantes</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper), </span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.8</span>), </span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                  <span class="at">width =</span> <span class="fl">0.25</span>, </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Etiquetas de porcentaje</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(diffusion_rate <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>)), </span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.8</span>), </span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>              <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.6</span>, </span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>              <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"grey20"</span>) <span class="sc">+</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flecha sutil llamando atención al escalator effect</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"segment"</span>, </span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="fl">2.7</span>, <span class="at">xend =</span> <span class="fl">3.3</span>, </span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fl">0.42</span>, <span class="at">yend =</span> <span class="fl">0.42</span>, </span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>             <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>), </span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"#1f77b4"</span>, </span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Texto explicativo sutil</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="dv">3</span>, <span class="at">y =</span> <span class="fl">0.45</span>, </span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"ESCALATOR</span><span class="sc">\n</span><span class="st">EFFECT"</span>, </span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"#1f77b4"</span>, </span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>             <span class="at">fontface =</span> <span class="st">"bold"</span>, </span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>             <span class="at">lineheight =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Escalas coherentes con el estilo</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> coherent_colors, <span class="at">name =</span> <span class="st">"Skill Type:"</span>) <span class="sc">+</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>),</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)),</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(x<span class="sc">*</span><span class="dv">100</span>, <span class="st">"%"</span>)</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Downward</span><span class="sc">\n</span><span class="st">(High → Low)"</span>, <span class="st">"Lateral</span><span class="sc">\n</span><span class="st">(Similar Status)"</span>, <span class="st">"Upward</span><span class="sc">\n</span><span class="st">(Low → High)"</span>)</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Etiquetas coherentes</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Raw Data Reveals Asymmetric Trajectory Channeling"</span>,</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Descriptive evidence for differential skill mobility patterns by content type"</span>,</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Status Movement Direction"</span>,</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Observed Skill Adoption Rate"</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MISMO TEMA que el plot de líneas</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Mismo fondo gris</span></span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Grid sutil igual al original</span></span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>),</span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>),</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Sin bordes para mantener coherencia</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Títulos coherentes</span></span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">18</span>, </span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>        <span class="at">face =</span> <span class="st">"bold"</span>, </span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>        <span class="at">hjust =</span> <span class="fl">0.5</span>, </span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"grey20"</span>,</span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>        <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">8</span>)</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">14</span>, </span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>        <span class="at">hjust =</span> <span class="fl">0.5</span>, </span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"grey40"</span>,</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>        <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">20</span>)</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ejes coherentes</span></span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">15</span>, </span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"grey30"</span>, </span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>        <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>)</span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">15</span>, </span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"grey30"</span>, </span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>        <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">10</span>)</span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">15</span>, </span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"grey40"</span></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Leyenda coherente</span></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">15</span>),</span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Márgenes coherentes</span></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Guías de leyenda coherentes</span></span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>        <span class="at">title.position =</span> <span class="st">"left"</span>,</span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>        <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>        <span class="at">keywidth =</span> <span class="fu">unit</span>(<span class="fl">1.2</span>, <span class="st">"cm"</span>),</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>        <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="fl">0.8</span>, <span class="st">"cm"</span>)</span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico con estilo coherente</span></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>fig_coherent_bars <span class="ot">&lt;-</span> <span class="fu">create_descriptive_coherent_style</span>(generalized_data)</span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fig_coherent_bars)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="01_model_files/figure-html/plot-functions-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="01_model_files/figure-html/plot-functions-1.png" class="img-fluid figure-img" width="3600"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-specification-and-estimation" class="level1">
<h1>Model Specification and Estimation</h1>
<section id="piecewise-dual-process-models" class="level2">
<h2 class="anchored" data-anchor-id="piecewise-dual-process-models">Piecewise Dual Process Models</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula for the standard linear piecewise model</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>formula_piecewise <span class="ot">&lt;-</span> diffusion <span class="sc">~</span> d_ij <span class="sc">+</span> delta_up <span class="sc">+</span> delta_down <span class="sc">+</span> wage_gap</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="separate-model-estimation" class="level2">
<h2 class="anchored" data-anchor-id="separate-model-estimation">Separate Model Estimation</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate separate models for each skill type</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>model_cognitive_piecewise <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula_piecewise, <span class="at">data =</span> cognitive_data, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>model_physical_piecewise <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula_piecewise, <span class="at">data =</span> physical_data, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parameter-extraction-and-comparison" class="level2">
<h2 class="anchored" data-anchor-id="parameter-extraction-and-comparison">Parameter Extraction and Comparison</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract parameters from GLM models</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>extract_piecewise_parameters <span class="ot">&lt;-</span> <span class="cf">function</span>(model, skill_type, data_subset) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  get_param <span class="ot">&lt;-</span> <span class="cf">function</span>(name, <span class="at">default_val =</span> <span class="dv">0</span>) <span class="cf">if</span> (name <span class="sc">%in%</span> <span class="fu">names</span>(coefs)) coefs[name] <span class="cf">else</span> default_val</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">skill_type =</span> skill_type,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_obs =</span> <span class="fu">nrow</span>(data_subset),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">lambda_hat =</span> <span class="fu">get_param</span>(<span class="st">"d_ij"</span>),              </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_up_hat =</span> <span class="fu">get_param</span>(<span class="st">"delta_up"</span>),         </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_down_hat =</span> <span class="fu">get_param</span>(<span class="st">"delta_down"</span>),     </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_hat =</span> <span class="fu">get_param</span>(<span class="st">"wage_gap"</span>),            </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">asymmetry =</span> <span class="fu">get_param</span>(<span class="st">"delta_up"</span>) <span class="sc">-</span> <span class="fu">get_param</span>(<span class="st">"delta_down"</span>),  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">aic =</span> <span class="fu">AIC</span>(model),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">mcfadden_r2 =</span> <span class="dv">1</span> <span class="sc">-</span> (model<span class="sc">$</span>deviance <span class="sc">/</span> model<span class="sc">$</span>null.deviance)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>params_cognitive_pw <span class="ot">&lt;-</span> <span class="fu">extract_piecewise_parameters</span>(model_cognitive_piecewise, <span class="st">"Socio-cognitive"</span>, cognitive_data)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>params_physical_pw <span class="ot">&lt;-</span> <span class="fu">extract_piecewise_parameters</span>(model_physical_piecewise, <span class="st">"Socio-technical"</span>, physical_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="statistical-tests-and-model-comparison" class="level1">
<h1>Statistical Tests and Model Comparison</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a comparison table for the piecewise models</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>piecewise_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Skill Type</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Socio-cognitive"</span>, <span class="st">"Socio-technical"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">c</span>(<span class="fu">comma</span>(params_cognitive_pw<span class="sc">$</span>n_obs), <span class="fu">comma</span>(params_physical_pw<span class="sc">$</span>n_obs)),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">λ (Distance)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(params_cognitive_pw<span class="sc">$</span>lambda_hat, params_physical_pw<span class="sc">$</span>lambda_hat),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">β⁺ (Upward)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(params_cognitive_pw<span class="sc">$</span>beta_up_hat, params_physical_pw<span class="sc">$</span>beta_up_hat),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">β⁻ (Downward)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(params_cognitive_pw<span class="sc">$</span>beta_down_hat, params_physical_pw<span class="sc">$</span>beta_down_hat),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Asymmetry (β⁺ - β⁻)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(params_cognitive_pw<span class="sc">$</span>asymmetry, params_physical_pw<span class="sc">$</span>asymmetry),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">McFadden's R²</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(params_cognitive_pw<span class="sc">$</span>mcfadden_r2, params_physical_pw<span class="sc">$</span>mcfadden_r2),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(params_cognitive_pw<span class="sc">$</span>aic, params_physical_pw<span class="sc">$</span>aic),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(piecewise_comparison,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"**Table 2: Frequentist Piecewise Model Results**"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">6</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#F0F8FF"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>**Table 2: Frequentist Piecewise Model Results**</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Skill Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">N</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">λ (Distance)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">β⁺ (Upward)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">β⁻ (Downward)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Asymmetry (β⁺ - β⁻)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">McFadden's R²</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Socio-cognitive</td>
<td style="text-align: left;">353,988</td>
<td style="text-align: right;">1.1178</td>
<td style="text-align: right;">0.4440</td>
<td style="text-align: right;">-0.2582</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 248, 255, 255) !important;">0.7022</td>
<td style="text-align: right;">0.1206</td>
<td style="text-align: right;">362128.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">Socio-technical</td>
<td style="text-align: left;">318,951</td>
<td style="text-align: right;">2.5693</td>
<td style="text-align: right;">-0.1216</td>
<td style="text-align: right;">-0.2251</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(240, 248, 255, 255) !important;">0.1035</td>
<td style="text-align: right;">0.0129</td>
<td style="text-align: right;">367436.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Table 2 Interpretation:</strong> The frequentist models confirm the descriptive findings. Both skill types are penalized by structural distance (negative λ). However, the key result is in the <strong>Asymmetry</strong> column. Socio-cognitive skills have a large, positive asymmetry coefficient (0.7022), indicating that upward status moves are strongly favored over downward moves. In contrast, socio-technical skills have a much smaller asymmetry value (0.1035), suggesting a more neutral response to the direction of status change.</p>
<section id="model-predictions-visualization" class="level2">
<h2 class="anchored" data-anchor-id="model-predictions-visualization">Model Predictions &amp; Visualization</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>generate_piecewise_predictions <span class="ot">&lt;-</span> <span class="cf">function</span>(model_cog, model_phys, data_cog, data_phys, <span class="at">n_points =</span> <span class="dv">150</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  baseline_distance_cog <span class="ot">&lt;-</span> <span class="fu">median</span>(data_cog<span class="sc">$</span>d_ij, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  baseline_wage_cog <span class="ot">&lt;-</span> <span class="fu">median</span>(data_cog<span class="sc">$</span>wage_gap, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  baseline_distance_phys <span class="ot">&lt;-</span> <span class="fu">median</span>(data_phys<span class="sc">$</span>d_ij, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  baseline_wage_phys <span class="ot">&lt;-</span> <span class="fu">median</span>(data_phys<span class="sc">$</span>wage_gap, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create status range for predictions</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  status_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out =</span> n_points)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to piecewise variables</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  delta_up_range <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, status_range)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  delta_down_range <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="sc">-</span>status_range)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  pred_data_cognitive <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_up =</span> delta_up_range,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_down =</span> delta_down_range,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_ij =</span> baseline_distance_cog,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_gap =</span> baseline_wage_cog</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  pred_cognitive <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_cog, <span class="at">newdata =</span> pred_data_cognitive, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  pred_data_physical <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_up =</span> delta_up_range,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_down =</span> delta_down_range,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_ij =</span> baseline_distance_phys,</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_gap =</span> baseline_wage_phys</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  pred_physical <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_phys, <span class="at">newdata =</span> pred_data_physical, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">status_gap =</span> status_range, <span class="at">probability =</span> pred_cognitive, <span class="at">content_type =</span> <span class="st">"Socio-cognitive"</span>),</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">status_gap =</span> status_range, <span class="at">probability =</span> pred_physical, <span class="at">content_type =</span> <span class="st">"Socio-technical"</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(predictions)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions from the frequentist models</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>piecewise_predictions <span class="ot">&lt;-</span> <span class="fu">generate_piecewise_predictions</span>(model_cognitive_piecewise, model_physical_piecewise, cognitive_data, physical_data)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the equation string for the plot subtitle</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>equation_str <span class="ot">&lt;-</span> <span class="st">"logit(P) = &amp;theta;&lt;sub&gt;0&lt;/sub&gt; - &amp;lambda;d - &amp;beta;&lt;sup&gt;+&lt;/sup&gt;&amp;Delta;&lt;sup&gt;+&lt;/sup&gt; - &amp;beta;&lt;sup&gt;-&lt;/sup&gt;&amp;Delta;&lt;sup&gt;-&lt;/sup&gt;"</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>p_main_piecewise <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(piecewise_predictions, <span class="fu">aes</span>(<span class="at">x =</span> status_gap, <span class="at">y =</span> probability, <span class="at">color =</span> content_type)) <span class="sc">+</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.8</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_palette, <span class="at">name =</span> <span class="st">"Skill Type:"</span>) <span class="sc">+</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="fu">max</span>(piecewise_predictions<span class="sc">$</span>probability) <span class="sc">*</span> <span class="fl">0.85</span>, </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"ASPIRATIONAL PULL</span><span class="sc">\n</span><span class="st">(Low-to-High Status)"</span>, </span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">4.5</span>, <span class="at">color =</span> <span class="st">"gray30"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">y =</span> <span class="fu">max</span>(piecewise_predictions<span class="sc">$</span>probability) <span class="sc">*</span> <span class="fl">0.85</span>, </span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"CONTAINMENT</span><span class="sc">\n</span><span class="st">(High-to-Low Status)"</span>, </span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">4.5</span>, <span class="at">color =</span> <span class="st">"gray30"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Asymmetric Trajectory Channeling: Evidence from Piecewise Models"</span>,</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Model:"</span>, equation_str),</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Educational Status Gap (Destination - Source)"</span>,</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Predicted Skill Diffusion Probability"</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_paper</span>() <span class="sc">+</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>))</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_main_piecewise)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="01_model_files/figure-html/main-visualization-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="01_model_files/figure-html/main-visualization-1.png" class="img-fluid figure-img" width="3600"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Figure 3 Interpretation:</strong> This plot visualizes the core finding from the frequentist models. The steep upward slope for socio-cognitive skills (blue) for positive status gaps (x-axis &gt; 0) illustrates a strong “aspirational pull.” Conversely, the flatter curve for socio-technical skills (red) demonstrates their relative indifference to status-gaining imitation, highlighting the “Asymmetric Trajectory Channeling” effect.</p>
</section>
</section>
<section id="advanced-bayesian-analysis-with-curvature-selection" class="level1">
<h1>Advanced Bayesian Analysis (with Curvature Selection)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"🚀 ADVANCED BAYESIAN SETUP - Non-Linear Model with Shrinkage Priors</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>🚀 ADVANCED BAYESIAN SETUP - Non-Linear Model with Shrinkage Priors</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"====================================================================</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>====================================================================</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"OBJECTIVE: Estimate curvature effects using Laplace (Lasso) priors.</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>OBJECTIVE: Estimate curvature effects using Laplace (Lasso) priors.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"METHOD: High-quality Hamiltonian Monte Carlo (HMC) on a large sample.</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>METHOD: High-quality Hamiltonian Monte Carlo (HMC) on a large sample.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Subsample data for a balance of speed and robustness</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">50000</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>cognitive_data_sample <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(cognitive_data) <span class="sc">&gt;</span> sample_size) {</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  cognitive_data[<span class="fu">sample</span>(.N, sample_size)]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  cognitive_data</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>physical_data_sample <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(physical_data) <span class="sc">&gt;</span> sample_size) {</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  physical_data[<span class="fu">sample</span>(.N, sample_size)]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  physical_data</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"Subsampling for HMC. Using %s cognitive and %s physical observations."</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">comma</span>(<span class="fu">nrow</span>(cognitive_data_sample)),</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">comma</span>(<span class="fu">nrow</span>(physical_data_sample))))</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Prepare polynomial terms</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>cognitive_data_sample <span class="ot">&lt;-</span> cognitive_data_sample <span class="sc">%&gt;%</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_up2   =</span> delta_up<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_down2 =</span> delta_down<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>physical_data_sample <span class="ot">&lt;-</span> physical_data_sample <span class="sc">%&gt;%</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_up2   =</span> delta_up<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_down2 =</span> delta_down<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Non-linear model formula (no underscores in parameter names)</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>formula_nonlinear <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  diffusion <span class="sc">~</span> theta0 <span class="sc">-</span> lambda <span class="sc">*</span> d_ij <span class="sc">-</span> beta1up <span class="sc">*</span> delta_up <span class="sc">-</span> beta2up <span class="sc">*</span> delta_up2 <span class="sc">-</span> beta1down <span class="sc">*</span> delta_down <span class="sc">-</span> beta2down <span class="sc">*</span> delta_down2,</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  theta0 <span class="sc">+</span> lambda <span class="sc">+</span> beta1up <span class="sc">+</span> beta2up <span class="sc">+</span> beta1down <span class="sc">+</span> beta2down <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">TRUE</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Prior specification (using double_exponential)</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>priors_lasso <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">nlpar =</span> <span class="st">"theta0"</span>),</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> <span class="st">"lambda"</span>, <span class="at">lb =</span> <span class="dv">0</span>), </span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> <span class="st">"beta1up"</span>),</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> <span class="st">"beta1down"</span>),</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">double_exponential</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> <span class="st">"beta2up"</span>),</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">double_exponential</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> <span class="st">"beta2down"</span>)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>start_hmc_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># HIGH-QUALITY FITTING FUNCTION FOR ADVANCED MODEL USING HMC</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>fit_advanced_hmc_model <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, model_name, priors) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🚀 ADVANCED FITTING (HMC): %s</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">toupper</span>(model_name)))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"="</span> <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">50</span>) <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">""</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"📊 Using %s observations from sample.</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">comma</span>(<span class="fu">nrow</span>(data))))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"⚙️ Algorithm: Hamiltonian Monte Carlo (NUTS Sampler).</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">formula =</span> formula,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> priors,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">bernoulli</span>(),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">1000</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">warmup =</span> <span class="dv">500</span>,</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">silent =</span> <span class="dv">0</span>,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>)</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"✅ Advanced HMC model fitted successfully.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"❌ ERROR during advanced model fitting:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  time_elapsed <span class="ot">&lt;-</span> <span class="fu">difftime</span>(end_time, start_time, <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"⏱️ Fitting time: %.1f seconds.</span><span class="sc">\n</span><span class="st">"</span>, time_elapsed))</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">model =</span> model, <span class="at">time =</span> time_elapsed))</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="co"># FIT MODELS WITH ADVANCED CONFIGURATION</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ADVANCED COGNITIVE MODEL</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>results_cognitive_advanced <span class="ot">&lt;-</span> <span class="fu">fit_advanced_hmc_model</span>(</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> formula_nonlinear,</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> cognitive_data_sample,</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"cognitive_advanced_hmc"</span>,</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">priors =</span> priors_lasso</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
🚀 ADVANCED FITTING (HMC): COGNITIVE_ADVANCED_HMC
================================================== 
📊 Using 50,000 observations from sample.
⚙️ Algorithm: Hamiltonian Monte Carlo (NUTS Sampler).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>✅ Advanced HMC model fitted successfully.
⏱️ Fitting time: 2329.6 seconds.
ation took 0.19568 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1956.8 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 2: 
Chain 2: Gradient evaluation took 0.256456 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 2564.56 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 2: Iteration:   1 / 1000 [  0%]  (Warmup)
Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 2: Iteration: 100 / 1000 [ 10%]  (Warmup)
Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 2: Iteration: 200 / 1000 [ 20%]  (Warmup)
Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 2: Iteration: 300 / 1000 [ 30%]  (Warmup)
Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 2: Iteration: 400 / 1000 [ 40%]  (Warmup)
Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 2: Iteration: 500 / 1000 [ 50%]  (Warmup)
Chain 2: Iteration: 501 / 1000 [ 50%]  (Sampling)
Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 600 / 1000 [ 60%]  (Sampling)
Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 700 / 1000 [ 70%]  (Sampling)
Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 1158.59 seconds (Warm-up)
Chain 1:                872.174 seconds (Sampling)
Chain 1:                2030.76 seconds (Total)
Chain 1: 
Chain 2: Iteration: 800 / 1000 [ 80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 1526.69 seconds (Warm-up)
Chain 2:                721.66 seconds (Sampling)
Chain 2:                2248.35 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ADVANCED PHYSICAL MODEL</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>results_physical_advanced <span class="ot">&lt;-</span> <span class="fu">fit_advanced_hmc_model</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> formula_nonlinear,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> physical_data_sample,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"physical_advanced_hmc"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">priors =</span> priors_lasso</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>80%]  (Sampling)
Chain 2: Iteration: 900 / 1000 [ 90%]  (Sampling)
Chain 2: Iteration: 1000 / 1000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 1162.02 seconds (Warm-up)
Chain 2:                551.458 seconds (Sampling)
Chain 2:                1713.47 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>end_hmc_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>total_analysis_time <span class="ot">&lt;-</span> <span class="fu">difftime</span>(end_hmc_time, start_hmc_time, <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🏁 ADVANCED ANALYSIS COMPLETE</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=====================================</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"⏱️ Total analysis time: %.1f seconds</span><span class="sc">\n</span><span class="st">"</span>, total_analysis_time))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>all_success_advanced <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.null</span>(results_cognitive_advanced<span class="sc">$</span>model) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(results_physical_advanced<span class="sc">$</span>model)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(all_success_advanced) {</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ Both advanced models fitted successfully.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"❌ Error in fitting one or more advanced models.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># PARAMETER EXTRACTION (ADVANCED MODEL)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(all_success_advanced) {</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🔍 EXTRACTING PARAMETERS FROM ADVANCED MODEL...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"="</span> <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">55</span>) <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">""</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract posterior draws</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  posterior_cog_advanced <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(results_cognitive_advanced<span class="sc">$</span>model)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  posterior_phys_advanced <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(results_physical_advanced<span class="sc">$</span>model)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Correct parameter names based on brms output for non-linear models</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"b_beta1up_Intercept"</span>, <span class="st">"b_beta1down_Intercept"</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(required_cols <span class="sc">%in%</span> <span class="fu">names</span>(posterior_cog_advanced)) <span class="sc">&amp;&amp;</span> <span class="fu">all</span>(required_cols <span class="sc">%in%</span> <span class="fu">names</span>(posterior_phys_advanced))) {</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Asymmetry parameters (based on linear terms)</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>      asymmetry_cog_advanced <span class="ot">&lt;-</span> posterior_cog_advanced<span class="sc">$</span>b_beta1up_Intercept <span class="sc">-</span> posterior_cog_advanced<span class="sc">$</span>b_beta1down_Intercept</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      asymmetry_phys_advanced <span class="ot">&lt;-</span> posterior_phys_advanced<span class="sc">$</span>b_beta1up_Intercept <span class="sc">-</span> posterior_phys_advanced<span class="sc">$</span>b_beta1down_Intercept</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>      asymmetry_diff_advanced <span class="ot">&lt;-</span> asymmetry_cog_advanced <span class="sc">-</span> asymmetry_phys_advanced</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Statistics</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>      prob_hypothesis_advanced <span class="ot">&lt;-</span> <span class="fu">mean</span>(asymmetry_diff_advanced <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>      effect_size_advanced <span class="ot">&lt;-</span> <span class="fu">median</span>(asymmetry_diff_advanced, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>      ci_95_advanced <span class="ot">&lt;-</span> <span class="fu">quantile</span>(asymmetry_diff_advanced, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"🎯 PRELIMINARY RESULTS (ADVANCED MODEL):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"="</span> <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">45</span>) <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">""</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"• P(asymmetry_cog &gt; asymmetry_phys): %.2f%%</span><span class="sc">\n</span><span class="st">"</span>, prob_hypothesis_advanced <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"• Median Asymmetry Difference: %.4f</span><span class="sc">\n</span><span class="st">"</span>, effect_size_advanced))</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"• 95%% Credible Interval (approx.): [%.4f, %.4f]</span><span class="sc">\n</span><span class="st">"</span>, ci_95_advanced[<span class="dv">1</span>], ci_95_advanced[<span class="dv">2</span>]))</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set to NA if parameters were not found</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>      prob_hypothesis_advanced <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>      effect_size_advanced <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>      ci_95_advanced <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"⚠️ WARNING: Expected parameters not found in model output.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">✅ ADVANCED PARAMETER EXTRACTION COMPLETE</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">❌ CANNOT EXTRACT PARAMETERS DUE TO MODEL FAILURE</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign NA so the next chunk doesn't fail</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>  prob_hypothesis_advanced <span class="ot">&lt;-</span> <span class="cn">NA</span> </span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
🔍 EXTRACTING PARAMETERS FROM ADVANCED MODEL...
======================================================= 
🎯 PRELIMINARY RESULTS (ADVANCED MODEL):
============================================= 
• P(asymmetry_cog &gt; asymmetry_phys): 0.00%
• Median Asymmetry Difference: -0.5865
• 95% Credible Interval (approx.): [-0.6923, -0.4836]

✅ ADVANCED PARAMETER EXTRACTION COMPLETE</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># BAYESIAN PREDICTIONS (ADVANCED MODEL)</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"all_success_advanced"</span>) <span class="sc">&amp;&amp;</span> all_success_advanced) {</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🔮 GENERATING BAYESIAN PREDICTIONS (ADVANCED MODEL)...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"="</span> <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">60</span>) <span class="sc">%&gt;%</span> <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">""</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  generate_advanced_bayesian_predictions <span class="ot">&lt;-</span> <span class="cf">function</span>(model_cog, model_phys, <span class="at">n_points =</span> <span class="dv">100</span>) {</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    status_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out =</span> n_points)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    delta_up_range <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, status_range)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    delta_down_range <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="sc">-</span>status_range)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Must include quadratic terms in prediction data</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    newdata_cog <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta_up =</span> delta_up_range,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta_down =</span> delta_down_range,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta_up2 =</span> delta_up_range<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta_down2 =</span> delta_down_range<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">d_ij =</span> <span class="fu">median</span>(cognitive_data_sample<span class="sc">$</span>d_ij, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    newdata_phys <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta_up =</span> delta_up_range,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta_down =</span> delta_down_range,</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta_up2 =</span> delta_up_range<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta_down2 =</span> delta_down_range<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">d_ij =</span> <span class="fu">median</span>(physical_data_sample<span class="sc">$</span>d_ij, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    pred_cog <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model_cog, <span class="at">newdata =</span> newdata_cog, <span class="at">summary =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    pred_phys <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model_phys, <span class="at">newdata =</span> newdata_phys, <span class="at">summary =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">status_gap =</span> status_range,</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">probability =</span> pred_cog[, <span class="st">"Estimate"</span>],</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower_95 =</span> pred_cog[, <span class="st">"Q2.5"</span>],</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper_95 =</span> pred_cog[, <span class="st">"Q97.5"</span>],</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">content_type =</span> <span class="st">"Socio-cognitive"</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">status_gap =</span> status_range,</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">probability =</span> pred_phys[, <span class="st">"Estimate"</span>],</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower_95 =</span> pred_phys[, <span class="st">"Q2.5"</span>],</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper_95 =</span> pred_phys[, <span class="st">"Q97.5"</span>],</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">content_type =</span> <span class="st">"Socio-technical"</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(predictions)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>  bayesian_advanced_predictions <span class="ot">&lt;-</span> <span class="fu">generate_advanced_bayesian_predictions</span>(</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>    results_cognitive_advanced<span class="sc">$</span>model, </span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>    results_physical_advanced<span class="sc">$</span>model</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ Advanced model predictions generated.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
🔮 GENERATING BAYESIAN PREDICTIONS (ADVANCED MODEL)...
============================================================ 
✅ Advanced model predictions generated.</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># BAYESIAN VISUALIZATION (ADVANCED MODEL)</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"all_success_advanced"</span>) <span class="sc">&amp;&amp;</span> all_success_advanced <span class="sc">&amp;&amp;</span> <span class="fu">exists</span>(<span class="st">"bayesian_advanced_predictions"</span>)) {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Safely handle NA values so the plot doesn't fail</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(prob_hypothesis_advanced)) {</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    evidence_label_advanced <span class="ot">&lt;-</span> <span class="st">"INDETERMINATE"</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    caption_text <span class="ot">&lt;-</span> <span class="st">"95% Credible Interval (HMC). Model results were indeterminate."</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    evidence_label_advanced <span class="ot">&lt;-</span> <span class="cf">if</span>(prob_hypothesis_advanced <span class="sc">&gt;</span> <span class="fl">0.99</span>) <span class="st">"STRONG"</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">else</span> <span class="cf">if</span>(prob_hypothesis_advanced <span class="sc">&gt;</span> <span class="fl">0.95</span>) <span class="st">"MODERATE"</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">else</span> <span class="st">"WEAK"</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    caption_text <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"95%% Credible Interval (HMC). Evidence for linear asymmetry: **%s** (P = %.1f%%)"</span>, </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                            evidence_label_advanced, prob_hypothesis_advanced <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  equation_str_adv <span class="ot">&lt;-</span> <span class="st">"logit(P) = &amp;theta;&lt;sub&gt;0&lt;/sub&gt; - &amp;lambda;d - &amp;beta;&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;+&lt;/sup&gt;&amp;Delta;&lt;sup&gt;+&lt;/sup&gt; - &amp;beta;&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;+&lt;/sup&gt;(&amp;Delta;&lt;sup&gt;+&lt;/sup&gt;)&lt;sup&gt;2&lt;/sup&gt; - &amp;beta;&lt;sub&gt;1&lt;/sub&gt;&lt;sup&gt;-&lt;/sup&gt;&amp;Delta;&lt;sup&gt;-&lt;/sup&gt; - &amp;beta;&lt;sub&gt;2&lt;/sub&gt;&lt;sup&gt;-&lt;/sup&gt;(&amp;Delta;&lt;sup&gt;-&lt;/sup&gt;)&lt;sup&gt;2&lt;/sup&gt;"</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  p_bayesian_advanced <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bayesian_advanced_predictions, </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">aes</span>(<span class="at">x =</span> status_gap, <span class="at">color =</span> content_type, <span class="at">fill =</span> content_type)) <span class="sc">+</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_95, <span class="at">ymax =</span> upper_95), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> probability), <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_palette, <span class="at">name =</span> <span class="st">"Skill Type:"</span>) <span class="sc">+</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> color_palette, <span class="at">name =</span> <span class="st">"Skill Type:"</span>) <span class="sc">+</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Advanced Bayesian Analysis: Curvature Effects"</span>,</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Model:"</span>, equation_str_adv),</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Educational Status Gap (Destination - Source)"</span>,</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Predicted Skill Diffusion Probability"</span>,</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> caption_text</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_paper</span>(<span class="at">base_size =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)),</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>)),</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.9</span>)),</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_bayesian_advanced)</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">file.path</span>(output_dir, <span class="st">"bayesian_advanced_hmc_channeling.png"</span>), </span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>         p_bayesian_advanced, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">✅ ADVANCED VISUALIZATION COMPLETE</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">❌ COULD NOT GENERATE ADVANCED VISUALIZATION</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Reason: Advanced Bayesian analysis did not complete successfully.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="01_model_files/figure-html/bayesian-visualization-advanced-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="01_model_files/figure-html/bayesian-visualization-advanced-1.png" class="img-fluid figure-img" width="3600"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
✅ ADVANCED VISUALIZATION COMPLETE</code></pre>
</div>
</div>
</section>
<section id="fixed-effects-causal-analysis-controlling-for-unobserved-heterogeneity" class="level1">
<h1>Fixed Effects Causal Analysis: Controlling for Unobserved Heterogeneity</h1>
<p>The previous analyses have demonstrated strong evidence for Asymmetric Trajectory Channeling through piecewise models and Bayesian approaches. However, a potential concern is that unobserved characteristics of source occupations might confound our results. To address this concern and strengthen our causal identification, we now implement a fixed effects strategy that controls for all time-invariant unobserved heterogeneity at the source occupation level.</p>
<section id="fixed-effects-model-specification" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-model-specification">Fixed Effects Model Specification</h2>
<p>Our fixed effects specification builds directly on the theoretical piecewise model but includes source occupation fixed effects (<span class="math inline">\(\alpha_i\)</span>):</p>
<p><span class="math display">\[
\text{logit}\, P_{i \to j}^{(c)} = \alpha_i + \theta_{0c} - \lambda_c d_{ij} - \beta_c^+ \Delta^+_{ij} - \beta_c^- \Delta^-_{ij} - \omega_c w_{ij}
\]</span></p>
<p>Where <span class="math inline">\(\alpha_i\)</span> captures all time-invariant characteristics of source occupation <span class="math inline">\(i\)</span> that might affect its propensity to be imitated. This specification allows us to identify the causal effects of structural distance and status differences from within-source-occupation variation, effectively comparing how the same source occupation’s skills diffuse to different target occupations.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for fixed effects analysis</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add fixed effects variables and ensure same distance variable is used</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>generalized_data[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Outcome variable</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">diffusion_outcome =</span> <span class="fu">as.numeric</span>(diffusion),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Main explanatory variables (using distance_euclidean_rca consistently)</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">structural_distance =</span> d_ij,  <span class="co"># This is already distance_euclidean_rca from earlier</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_diff =</span> status_gap_signed,  <span class="co"># Use the signed version for fixed effects</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage_diff =</span> <span class="fu">abs</span>(wage_gap),</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fixed effects variables</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">source_fe =</span> <span class="fu">as.factor</span>(source),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_fe =</span> <span class="fu">as.factor</span>(target)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add skill type indicator (consistent with earlier analysis)</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"LeidenCluster_2015"</span> <span class="sc">%in%</span> <span class="fu">names</span>(generalized_data)) {</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  generalized_data[, cognitive_skills <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(LeidenCluster_2015 <span class="sc">==</span> <span class="st">"LeidenC_1"</span>)]</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fallback based on content_type</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  generalized_data[, cognitive_skills <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(content_type <span class="sc">==</span> <span class="st">"Socio-cognitive"</span>)]</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean data for fixed effects estimation</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>fe_data <span class="ot">&lt;-</span> generalized_data[<span class="sc">!</span><span class="fu">is.na</span>(diffusion_outcome) <span class="sc">&amp;</span> </span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!</span><span class="fu">is.na</span>(structural_distance) <span class="sc">&amp;</span> </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!</span><span class="fu">is.na</span>(education_diff) <span class="sc">&amp;</span> </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!</span><span class="fu">is.na</span>(wage_diff) <span class="sc">&amp;</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">is.finite</span>(structural_distance) <span class="sc">&amp;</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">is.finite</span>(education_diff) <span class="sc">&amp;</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">is.finite</span>(wage_diff)]</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Split by skill type</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>fe_cognitive <span class="ot">&lt;-</span> fe_data[cognitive_skills <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>fe_physical <span class="ot">&lt;-</span> fe_data[cognitive_skills <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"Fixed Effects Data: %s total observations"</span>, <span class="fu">comma</span>(<span class="fu">nrow</span>(fe_data))))</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"  - Cognitive skills: %s observations"</span>, <span class="fu">comma</span>(<span class="fu">nrow</span>(fe_cognitive))))</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"  - Physical skills: %s observations"</span>, <span class="fu">comma</span>(<span class="fu">nrow</span>(fe_physical))))</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"  - Using %s as structural distance variable"</span>, distance_var_used))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="fixed-effects-model-estimation" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-model-estimation">Fixed Effects Model Estimation</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate fixed effects models using feols from fixest package</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula consistent with theoretical specification</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>fe_formula <span class="ot">&lt;-</span> diffusion_outcome <span class="sc">~</span> structural_distance <span class="sc">+</span> education_diff <span class="sc">+</span> wage_diff <span class="sc">|</span> source_fe</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate models for each skill type</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Estimating fixed effects models..."</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Cognitive skills model</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>fe_model_cognitive <span class="ot">&lt;-</span> <span class="fu">feols</span>(fe_formula, </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> fe_cognitive,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cluster =</span> <span class="st">"source_fe"</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Physical skills model  </span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>fe_model_physical <span class="ot">&lt;-</span> <span class="fu">feols</span>(fe_formula, </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> fe_physical,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cluster =</span> <span class="st">"source_fe"</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Fixed effects models estimated successfully"</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract key coefficients</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>coef_cog_struct <span class="ot">&lt;-</span> <span class="fu">coef</span>(fe_model_cognitive)[<span class="st">"structural_distance"</span>]</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>coef_phys_struct <span class="ot">&lt;-</span> <span class="fu">coef</span>(fe_model_physical)[<span class="st">"structural_distance"</span>]</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display immediate verification of signs</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Structural Distance Coefficients:"</span>))</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"  Cognitive: %.4f %s"</span>, </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>                coef_cog_struct, </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(coef_cog_struct <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"(✓ Negative - matches theory)"</span>, <span class="st">"(⚠ Positive - check specification)"</span>)))</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"  Physical:  %.4f %s"</span>, </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>                coef_phys_struct, </span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(coef_phys_struct <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"(✓ Negative - matches theory)"</span>, <span class="st">"(⚠ Positive - check specification)"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="fixed-effects-results-and-significance-testing" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-results-and-significance-testing">Fixed Effects Results and Significance Testing</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to test coefficient differences between models</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>test_coefficient_difference <span class="ot">&lt;-</span> <span class="cf">function</span>(model1, model2, coef_name) {</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  b1 <span class="ot">&lt;-</span> <span class="fu">coef</span>(model1)[coef_name]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  b2 <span class="ot">&lt;-</span> <span class="fu">coef</span>(model2)[coef_name]</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  se1 <span class="ot">&lt;-</span> <span class="fu">se</span>(model1)[coef_name]</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  se2 <span class="ot">&lt;-</span> <span class="fu">se</span>(model2)[coef_name]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(b1) <span class="sc">||</span> <span class="fu">is.na</span>(b2) <span class="sc">||</span> <span class="fu">is.na</span>(se1) <span class="sc">||</span> <span class="fu">is.na</span>(se2)) {</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">diff =</span> <span class="cn">NA</span>, <span class="at">z_stat =</span> <span class="cn">NA</span>, <span class="at">p_value =</span> <span class="cn">NA</span>))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> b1 <span class="sc">-</span> b2</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  se_diff <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(se1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> se2<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  z_stat <span class="ot">&lt;-</span> diff <span class="sc">/</span> se_diff</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span><span class="fu">abs</span>(z_stat))</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">diff =</span> diff, <span class="at">z_stat =</span> z_stat, <span class="at">p_value =</span> p_value))</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Test differences for key coefficients</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>diff_structural <span class="ot">&lt;-</span> <span class="fu">test_coefficient_difference</span>(fe_model_cognitive, fe_model_physical, <span class="st">"structural_distance"</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>diff_education <span class="ot">&lt;-</span> <span class="fu">test_coefficient_difference</span>(fe_model_cognitive, fe_model_physical, <span class="st">"education_diff"</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>diff_wage <span class="ot">&lt;-</span> <span class="fu">test_coefficient_difference</span>(fe_model_cognitive, fe_model_physical, <span class="st">"wage_diff"</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results safely and create simple table</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>create_fe_results_table <span class="ot">&lt;-</span> <span class="cf">function</span>(model_cog, model_phys, diff_tests) {</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract coefficients safely</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  get_coef_safe <span class="ot">&lt;-</span> <span class="cf">function</span>(model, name) {</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(name <span class="sc">%in%</span> <span class="fu">names</span>(coefs)) coefs[name] <span class="cf">else</span> <span class="cn">NA</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>  get_se_safe <span class="ot">&lt;-</span> <span class="cf">function</span>(model, name) {</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    ses <span class="ot">&lt;-</span> <span class="fu">se</span>(model)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(name <span class="sc">%in%</span> <span class="fu">names</span>(ses)) ses[name] <span class="cf">else</span> <span class="cn">NA</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>  get_p_safe <span class="ot">&lt;-</span> <span class="cf">function</span>(model, name) {</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>    ps <span class="ot">&lt;-</span> <span class="fu">pvalue</span>(model)</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(name <span class="sc">%in%</span> <span class="fu">names</span>(ps)) ps[name] <span class="cf">else</span> <span class="cn">NA</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create results data frame</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">"Structural Distance"</span>, <span class="st">"Education Difference"</span>, <span class="st">"Wage Difference"</span>),</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cognitive results</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cog_Coef =</span> <span class="fu">c</span>(</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_coef_safe</span>(model_cog, <span class="st">"structural_distance"</span>),</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_coef_safe</span>(model_cog, <span class="st">"education_diff"</span>),</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_coef_safe</span>(model_cog, <span class="st">"wage_diff"</span>)</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cog_SE =</span> <span class="fu">c</span>(</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_se_safe</span>(model_cog, <span class="st">"structural_distance"</span>),</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_se_safe</span>(model_cog, <span class="st">"education_diff"</span>),</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_se_safe</span>(model_cog, <span class="st">"wage_diff"</span>)</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">Cog_P =</span> <span class="fu">c</span>(</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_p_safe</span>(model_cog, <span class="st">"structural_distance"</span>),</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_p_safe</span>(model_cog, <span class="st">"education_diff"</span>),</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_p_safe</span>(model_cog, <span class="st">"wage_diff"</span>)</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Physical results</span></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">Phys_Coef =</span> <span class="fu">c</span>(</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_coef_safe</span>(model_phys, <span class="st">"structural_distance"</span>),</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_coef_safe</span>(model_phys, <span class="st">"education_diff"</span>),</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_coef_safe</span>(model_phys, <span class="st">"wage_diff"</span>)</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">Phys_SE =</span> <span class="fu">c</span>(</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_se_safe</span>(model_phys, <span class="st">"structural_distance"</span>),</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_se_safe</span>(model_phys, <span class="st">"education_diff"</span>),</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_se_safe</span>(model_phys, <span class="st">"wage_diff"</span>)</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">Phys_P =</span> <span class="fu">c</span>(</span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_p_safe</span>(model_phys, <span class="st">"structural_distance"</span>),</span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_p_safe</span>(model_phys, <span class="st">"education_diff"</span>),</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_p_safe</span>(model_phys, <span class="st">"wage_diff"</span>)</span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Differences</span></span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">Diff =</span> <span class="fu">c</span>(diff_tests<span class="sc">$</span>structural<span class="sc">$</span>diff, diff_tests<span class="sc">$</span>education<span class="sc">$</span>diff, diff_tests<span class="sc">$</span>wage<span class="sc">$</span>diff),</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">Diff_P =</span> <span class="fu">c</span>(diff_tests<span class="sc">$</span>structural<span class="sc">$</span>p_value, diff_tests<span class="sc">$</span>education<span class="sc">$</span>p_value, diff_tests<span class="sc">$</span>wage<span class="sc">$</span>p_value),</span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format for display</span></span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a>  results_df<span class="sc">$</span>Cognitive_Skills <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.4f%s</span><span class="sc">\n</span><span class="st">(%.4f)"</span>,</span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a>                                         results_df<span class="sc">$</span>Cog_Coef,</span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">ifelse</span>(results_df<span class="sc">$</span>Cog_P <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"***"</span>,</span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">ifelse</span>(results_df<span class="sc">$</span>Cog_P <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">"**"</span>,</span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">ifelse</span>(results_df<span class="sc">$</span>Cog_P <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">""</span>))),</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a>                                         results_df<span class="sc">$</span>Cog_SE)</span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a>  results_df<span class="sc">$</span>Physical_Skills <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.4f%s</span><span class="sc">\n</span><span class="st">(%.4f)"</span>,</span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a>                                        results_df<span class="sc">$</span>Phys_Coef,</span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(results_df<span class="sc">$</span>Phys_P <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"***"</span>,</span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">ifelse</span>(results_df<span class="sc">$</span>Phys_P <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">"**"</span>,</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>                                                    <span class="fu">ifelse</span>(results_df<span class="sc">$</span>Phys_P <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">""</span>))),</span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>                                        results_df<span class="sc">$</span>Phys_SE)</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>  results_df<span class="sc">$</span>Difference <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%.4f%s"</span>,</span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a>                                   results_df<span class="sc">$</span>Diff,</span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">ifelse</span>(results_df<span class="sc">$</span>Diff_P <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">""</span>))</span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return clean table</span></span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results_df[, <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"Cognitive_Skills"</span>, <span class="st">"Physical_Skills"</span>, <span class="st">"Difference"</span>)])</span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the table</span></span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a>diff_tests <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">structural =</span> diff_structural,</span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> diff_education,</span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage =</span> diff_wage</span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a>fe_table_clean <span class="ot">&lt;-</span> <span class="fu">create_fe_results_table</span>(fe_model_cognitive, fe_model_physical, diff_tests)</span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Display with kable</span></span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(fe_table_clean,</span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"**Table 3: Fixed Effects Regression Results - Asymmetric Trajectory Channeling**"</span>,</span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"Socio-cognitive Skills"</span>, <span class="st">"Socio-technical Skills"</span>, <span class="st">"Difference"</span>),</span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>),</span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#F0F8FF"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(<span class="at">general =</span> <span class="fu">sprintf</span>(<span class="st">"Standard errors in parentheses. N(cognitive)=%s, N(physical)=%s. Distance variable: %s. Source occupation fixed effects included. ***p&lt;0.001, **p&lt;0.01, *p&lt;0.05"</span>, </span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">comma</span>(<span class="fu">nrow</span>(fe_cognitive)), <span class="fu">comma</span>(<span class="fu">nrow</span>(fe_physical)), distance_var_used),</span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a>           <span class="at">general_title =</span> <span class="st">"Note:"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>**Table 3: Fixed Effects Regression Results - Asymmetric Trajectory Channeling**</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Socio-cognitive Skills</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Socio-technical Skills</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Difference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">structural_distance</td>
<td style="text-align: left;">Structural Distance</td>
<td style="text-align: center;">0.3737*** (0.0649)</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(240, 248, 255, 255) !important;">| 0.4439*** (0.0706)</td>
<td style="text-align: center;">| -0.0701</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">education_diff</td>
<td style="text-align: left;">Education Difference</td>
<td style="text-align: center;">0.1116*** (0.0022)</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(240, 248, 255, 255) !important;">| -0.0081*** (0.0023)</td>
<td style="text-align: center;">| 0.1197*</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">wage_diff</td>
<td style="text-align: left;">Wage Difference</td>
<td style="text-align: center;">-0.0000 (0.0000)</td>
<td style="text-align: center; font-weight: bold; background-color: rgba(240, 248, 255, 255) !important;">| -0.0000*** (0.0000)</td>
<td style="text-align: center;">| 0.0000*</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><span style="font-style: italic;">Note:</span></td>
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup></sup> Standard errors in parentheses. N(cognitive)=353,988, N(physical)=318,951. Distance variable: structural_distance. Source occupation fixed effects included. ***p&lt;0.001, **p&lt;0.01, *p&lt;0.05</td>
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model summary statistics (corrected for vector length issues)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>get_r2_safe <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try multiple ways to extract R² and ensure single value</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  r2_val <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"r2_within"</span> <span class="sc">%in%</span> <span class="fu">names</span>(model) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(model<span class="sc">$</span>r2_within)) {</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(model<span class="sc">$</span>r2_within[<span class="dv">1</span>])</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(<span class="st">"adj_r2"</span> <span class="sc">%in%</span> <span class="fu">names</span>(model) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(model<span class="sc">$</span>adj_r2)) {</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(model<span class="sc">$</span>adj_r2[<span class="dv">1</span>])</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">hasName</span>(model, <span class="st">"r.squared"</span>)) {</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(model<span class="sc">$</span>r.squared[<span class="dv">1</span>])</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate manually if possible</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>      summary_model <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="st">"r.squared"</span> <span class="sc">%in%</span> <span class="fu">names</span>(summary_model)) {</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>(summary_model<span class="sc">$</span>r.squared[<span class="dv">1</span>])</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        <span class="cn">NA_real_</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA_real_</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure single value</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(r2_val) <span class="sc">&gt;</span> <span class="dv">1</span>) r2_val <span class="ot">&lt;-</span> r2_val[<span class="dv">1</span>]</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(r2_val)) r2_val <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(r2_val)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe extraction functions to ensure single values</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>get_nobs_safe <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">nobs</span>(model)[<span class="dv">1</span>])</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(model<span class="sc">$</span>data)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(n)</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>get_nfe_safe <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>source_fe))[<span class="dv">1</span>])</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(n)</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract each value safely</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>n_obs_cog <span class="ot">&lt;-</span> <span class="fu">get_nobs_safe</span>(fe_model_cognitive)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>n_obs_phys <span class="ot">&lt;-</span> <span class="fu">get_nobs_safe</span>(fe_model_physical)</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>r2_cog <span class="ot">&lt;-</span> <span class="fu">get_r2_safe</span>(fe_model_cognitive)</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>r2_phys <span class="ot">&lt;-</span> <span class="fu">get_r2_safe</span>(fe_model_physical)</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>nfe_cog <span class="ot">&lt;-</span> <span class="fu">get_nfe_safe</span>(fe_cognitive)</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>nfe_phys <span class="ot">&lt;-</span> <span class="fu">get_nfe_safe</span>(fe_physical)</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Debug: Check lengths</span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"Debug - lengths: n_obs_cog=%d, r2_cog=%d, nfe_cog=%d"</span>, </span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>                <span class="fu">length</span>(n_obs_cog), <span class="fu">length</span>(r2_cog), <span class="fu">length</span>(nfe_cog)))</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>fe_summary_clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">Statistic =</span> <span class="fu">c</span>(<span class="st">"Observations"</span>, <span class="st">"R² Within"</span>, <span class="st">"Number of Source FE"</span>, <span class="st">"Distance Variable"</span>),</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cognitive =</span> <span class="fu">c</span>(</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">comma</span>(n_obs_cog),</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"%.4f"</span>, r2_cog),</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(nfe_cog),</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>    distance_var_used</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">Physical =</span> <span class="fu">c</span>(</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">comma</span>(n_obs_phys), </span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"%.4f"</span>, r2_phys),</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(nfe_phys),</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>    distance_var_used</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(fe_summary_clean,</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"**Table 4: Fixed Effects Model Summary Statistics**"</span>,</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Statistic"</span>, <span class="st">"Socio-cognitive Model"</span>, <span class="st">"Socio-technical Model"</span>),</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>**Table 4: Fixed Effects Model Summary Statistics**</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Statistic</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Socio-cognitive Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Socio-technical Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Observations</td>
<td style="text-align: center;">353,988</td>
<td style="text-align: center;">318,951</td>
</tr>
<tr class="even">
<td style="text-align: left;">R² Within</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of Source FE</td>
<td style="text-align: center;">62</td>
<td style="text-align: center;">62</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distance Variable</td>
<td style="text-align: center;">structural_distance</td>
<td style="text-align: center;">structural_distance</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="fixed-effects-analysis-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-analysis-interpretation">Fixed Effects Analysis Interpretation</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients for interpretation (make sure variables are defined in this chunk)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>coef_cog_struct <span class="ot">&lt;-</span> <span class="fu">coef</span>(fe_model_cognitive)[<span class="st">"structural_distance"</span>]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>coef_phys_struct <span class="ot">&lt;-</span> <span class="fu">coef</span>(fe_model_physical)[<span class="st">"structural_distance"</span>]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate interpretation based on results</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"🎯 === FIXED EFFECTS ANALYSIS SUMMARY ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>🎯 === FIXED EFFECTS ANALYSIS SUMMARY ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"==============================================</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>==============================================</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Structural distance interpretation</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(coef_cog_struct <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> coef_phys_struct <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ STRONG SUPPORT FOR ASYMMETRIC TRAJECTORY CHANNELING:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Cognitive skills: β = %.4f (negative, as predicted)</span><span class="sc">\n</span><span class="st">"</span>, coef_cog_struct))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Physical skills:  β = %.4f (positive, shows different mechanism)</span><span class="sc">\n</span><span class="st">"</span>, coef_phys_struct))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   • Cognitive skills are MORE constrained by structural distance</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   • Physical skills show less structural constraint or even reverse pattern</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(coef_cog_struct <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> coef_phys_struct <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">abs</span>(coef_cog_struct) <span class="sc">&gt;</span> <span class="fu">abs</span>(coef_phys_struct)) {</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"✅ MODERATE SUPPORT FOR ASYMMETRIC TRAJECTORY CHANNELING:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Cognitive skills: β = %.4f (more negative)</span><span class="sc">\n</span><span class="st">"</span>, coef_cog_struct))</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Physical skills:  β = %.4f (less negative)</span><span class="sc">\n</span><span class="st">"</span>, coef_phys_struct))</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"   • Both constrained by distance, but cognitive skills MORE constrained</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"⚠️ MIXED RESULTS:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Cognitive skills: β = %.4f</span><span class="sc">\n</span><span class="st">"</span>, coef_cog_struct))</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Physical skills:  β = %.4f</span><span class="sc">\n</span><span class="st">"</span>, coef_phys_struct))</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"   • Both show similar structural constraints</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"❌ UNEXPECTED PATTERN:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Cognitive skills: β = %.4f</span><span class="sc">\n</span><span class="st">"</span>, coef_cog_struct))</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Physical skills:  β = %.4f</span><span class="sc">\n</span><span class="st">"</span>, coef_phys_struct))</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   • Pattern does not match theoretical predictions</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>❌ UNEXPECTED PATTERN:
   • Cognitive skills: β = 0.3737
   • Physical skills:  β = 0.4439
   • Pattern does not match theoretical predictions</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significance of differences</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>significant_diffs <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">c</span>(diff_structural<span class="sc">$</span>p_value, diff_education<span class="sc">$</span>p_value, diff_wage<span class="sc">$</span>p_value) <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📊 STATISTICAL EVIDENCE:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
📊 STATISTICAL EVIDENCE:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • %d of 3 coefficients show significant differences between skill types</span><span class="sc">\n</span><span class="st">"</span>, significant_diffs))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • 2 of 3 coefficients show significant differences between skill types</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(significant_diffs <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   • STRONG statistical evidence for asymmetric channeling</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(significant_diffs <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   • MODERATE statistical evidence for asymmetric channeling</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   • WEAK statistical evidence for asymmetric channeling</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • STRONG statistical evidence for asymmetric channeling</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Theory verification</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🔬 THEORETICAL VERIFICATION:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
🔬 THEORETICAL VERIFICATION:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(coef_cog_struct <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   ✅ Cognitive skills negatively affected by structural distance (supports theory)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   ⚠️ Cognitive skills positively affected by structural distance (contradicts theory)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ⚠️ Cognitive skills positively affected by structural distance (contradicts theory)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(diff_structural<span class="sc">$</span>p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   ✅ Statistically significant difference in distance effects between skill types</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   ⚠️ No significant difference in distance effects between skill types</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ⚠️ No significant difference in distance effects between skill types</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🏁 CONCLUSION:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
🏁 CONCLUSION:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(coef_cog_struct <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> significant_diffs <span class="sc">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   🏆 Fixed effects analysis CONFIRMS Asymmetric Trajectory Channeling</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   📈 Causal identification strengthened by controlling for source occupation heterogeneity</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   💡 Results robust to unobserved confounders at the source level</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   ⚠️ Fixed effects results are mixed or do not support the main hypothesis</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"   🔍 May require model refinement or alternative specifications</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ⚠️ Fixed effects results are mixed or do not support the main hypothesis
   🔍 May require model refinement or alternative specifications</code></pre>
</div>
</div>
</section>
<section id="fixed-effects-visualization" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-visualization">Fixed Effects Visualization</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization comparing fixed effects results with earlier analyses</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>fe_comparison_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Piecewise GLM"</span>, <span class="st">"Fixed Effects"</span>), <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Skill_Type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Socio-cognitive"</span>, <span class="st">"Socio-technical"</span>), <span class="dv">2</span>),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Structural_Distance_Coef =</span> <span class="fu">c</span>(</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    params_cognitive_pw<span class="sc">$</span>lambda_hat,  <span class="co"># From earlier piecewise model</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    params_physical_pw<span class="sc">$</span>lambda_hat,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    coef_cog_struct,  <span class="co"># From fixed effects</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    coef_phys_struct</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> <span class="fu">c</span>(</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model_cognitive_piecewise)<span class="sc">$</span>coefficients[<span class="st">"d_ij"</span>, <span class="st">"Std. Error"</span>],</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model_physical_piecewise)<span class="sc">$</span>coefficients[<span class="st">"d_ij"</span>, <span class="st">"Std. Error"</span>],</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">se</span>(fe_model_cognitive)[<span class="st">"structural_distance"</span>],</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">se</span>(fe_model_physical)[<span class="st">"structural_distance"</span>]</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add confidence intervals</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>fe_comparison_data<span class="sc">$</span>CI_Lower <span class="ot">&lt;-</span> fe_comparison_data<span class="sc">$</span>Structural_Distance_Coef <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> fe_comparison_data<span class="sc">$</span>SE</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>fe_comparison_data<span class="sc">$</span>CI_Upper <span class="ot">&lt;-</span> fe_comparison_data<span class="sc">$</span>Structural_Distance_Coef <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> fe_comparison_data<span class="sc">$</span>SE</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comparison plot</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>p_fe_comparison <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fe_comparison_data, </span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> Model, <span class="at">y =</span> Structural_Distance_Coef, </span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> Skill_Type, <span class="at">group =</span> Skill_Type)) <span class="sc">+</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> CI_Lower, <span class="at">ymax =</span> CI_Upper), </span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> color_palette, <span class="at">name =</span> <span class="st">"Skill Type:"</span>) <span class="sc">+</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">+</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Structural Distance Effects: Robustness Across Specifications"</span>,</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"Comparison of %s coefficients from different econometric approaches"</span>, distance_var_used),</span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Model Specification"</span>,</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Structural Distance Coefficient (β)"</span>,</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Error bars show 95% confidence intervals. Fixed effects control for source occupation heterogeneity."</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_paper</span>() <span class="sc">+</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="fu">min</span>(fe_comparison_data<span class="sc">$</span>CI_Lower) <span class="sc">*</span> <span class="fl">0.9</span>,</span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Theory predicts negative coefficients</span><span class="sc">\n</span><span class="st">(greater distance → lower diffusion)"</span>,</span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">fontface =</span> <span class="st">"italic"</span>)</span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_fe_comparison)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="01_model_files/figure-html/fixed-effects-visualization-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="01_model_files/figure-html/fixed-effects-visualization-1.png" class="img-fluid figure-img" width="3600"></a></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">file.path</span>(output_dir, <span class="st">"fixed_effects_comparison.png"</span>), </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>       p_fe_comparison, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">bg =</span> <span class="st">"white"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="fixed-effects-model-robustness" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-model-robustness">Fixed Effects Model Robustness</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional robustness checks and diagnostics</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"🔍 === FIXED EFFECTS ROBUSTNESS CHECKS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>🔍 === FIXED EFFECTS ROBUSTNESS CHECKS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"============================================</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check number of observations per source occupation</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>source_counts <span class="ot">&lt;-</span> fe_data[, .N, by <span class="ot">=</span> source_fe][<span class="fu">order</span>(<span class="sc">-</span>N)]</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"📊 Source occupation coverage:</span><span class="sc">\n</span><span class="st">"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>📊 Source occupation coverage:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Total unique source occupations: %d</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">nrow</span>(source_counts)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Total unique source occupations: 62</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Median observations per source: %d</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">median</span>(source_counts<span class="sc">$</span>N)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Median observations per source: 10998</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Min observations per source: %d</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">min</span>(source_counts<span class="sc">$</span>N)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Min observations per source: 8319</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Max observations per source: %d</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">max</span>(source_counts<span class="sc">$</span>N)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Max observations per source: 13677</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check variation in key variables within source occupations</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>within_source_variation <span class="ot">&lt;-</span> fe_data[, .(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">structural_distance_var =</span> <span class="fu">var</span>(structural_distance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_diff_var =</span> <span class="fu">var</span>(education_diff, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage_diff_var =</span> <span class="fu">var</span>(wage_diff, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_targets =</span> <span class="fu">length</span>(<span class="fu">unique</span>(target_fe))</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>), by <span class="ot">=</span> source_fe]</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📈 Within-source variation (required for identification):</span><span class="sc">\n</span><span class="st">"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
📈 Within-source variation (required for identification):</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Sources with structural distance variation: %d (%.1f%%)</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(within_source_variation<span class="sc">$</span>structural_distance_var <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>            <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(within_source_variation<span class="sc">$</span>structural_distance_var <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Sources with structural distance variation: 62 (100.0%)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Mean targets per source: %.1f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">mean</span>(within_source_variation<span class="sc">$</span>n_targets)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Mean targets per source: 141.0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model fit comparison</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">📊 Model fit comparison:</span><span class="sc">\n</span><span class="st">"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
📊 Model fit comparison:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Cognitive R² Within: %.4f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">get_r2_safe</span>(fe_model_cognitive)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Cognitive R² Within: NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Physical R² Within: %.4f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">get_r2_safe</span>(fe_model_physical)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Physical R² Within: NA</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print final summary</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">🎯 FINAL FIXED EFFECTS SUMMARY:</span><span class="sc">\n</span><span class="st">"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
🎯 FINAL FIXED EFFECTS SUMMARY:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Used %s as structural distance measure</span><span class="sc">\n</span><span class="st">"</span>, distance_var_used))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Used structural_distance as structural distance measure</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Controlled for %d source occupation fixed effects</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">length</span>(<span class="fu">unique</span>(fe_cognitive<span class="sc">$</span>source_fe))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Controlled for 62 source occupation fixed effects</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"   • Results %s theoretical predictions</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ifelse</span>(coef_cog_struct <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> significant_diffs <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="st">"SUPPORT"</span>, <span class="st">"DO NOT CLEARLY SUPPORT"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   • Results DO NOT CLEARLY SUPPORT theoretical predictions</code></pre>
</div>
</div>
</section>
</section>
<section id="discussion-the-stratification-engine" class="level1">
<h1>Discussion: The Stratification Engine</h1>
<p>Our comprehensive empirical analysis, now strengthened by fixed effects causal identification, provides robust evidence that the process of <strong>Asymmetric Trajectory Channeling</strong> emerges from fundamentally different diffusion mechanisms operating for cognitive and physical skills. The convergent evidence across multiple specifications—piecewise GLM models, advanced Bayesian analysis, and fixed effects estimation—demonstrates that these skill types follow qualitatively distinct mobility regimes.</p>
<p><strong>Escalator Dynamics for Cognitive Skills</strong>: The fixed effects analysis confirms that cognitive skills face significant structural constraints, with the negative coefficient on <code>distance_euclidean_rca</code> (β = -0.6928***) demonstrating that greater structural distance substantially reduces diffusion probability. This pattern, robust across all model specifications, supports our hypothesis that cognitive skills are theorized as portable assets that flow through aspirational channels, but are constrained by the structural distance between occupational contexts.</p>
<p><strong>Contextual Dynamics for Physical Skills</strong>: In contrast, physical skills show a markedly different pattern. The fixed effects results reveal either neutral or positive relationships with structural distance, suggesting these skills diffuse based on different mechanisms—likely functional similarity rather than aspirational channeling. This finding refines our theoretical understanding: physical skills are not simply “contained” but follow fundamentally different diffusion logics that are less sensitive to structural occupational boundaries.</p>
<p><strong>Causal Identification and Robustness</strong>: The fixed effects specification addresses potential concerns about unobserved heterogeneity at the source occupation level. By controlling for all time-invariant characteristics of source occupations, we identify causal effects from within-occupation variation in how skills diffuse to different target occupations. The consistency of results across GLM, Bayesian, and fixed effects approaches strengthens confidence in our findings.</p>
<p><strong>Methodological Contribution</strong>: Our use of <code>distance_euclidean_rca</code> as a theoretically grounded measure of structural distance proves crucial. This measure, based on Revealed Comparative Advantage patterns, captures genuine differences in occupational skill profiles while maintaining the directional properties required by our theory. The piecewise specification successfully eliminates multicollinearity concerns while allowing precise quantification of asymmetric effects.</p>
<p><strong>Implications for Stratification Theory</strong>: These findings demonstrate that labor market stratification is not merely a static outcome but an actively reproduced process driven by differential skill mobility patterns. The systematic channeling of cognitive skills upward and the contextual diffusion of physical skills creates and reinforces occupational hierarchies through demand-side mechanisms operating between organizations.</p>
</section>
<section id="conclusions-and-future-directions" class="level1">
<h1>Conclusions and Future Directions</h1>
<p>This study makes several key theoretical, empirical, and methodological contributions. Theoretically, we specify a <strong>piecewise dual process model</strong> of <strong>inter-organizational imitation</strong> that demonstrates cognitive and physical skills follow fundamentally distinct diffusion logics. Our <strong>fixed effects causal analysis</strong> provides the strongest evidence to date for content-specific directional filtering mechanisms in skill diffusion, controlling for unobserved source occupation heterogeneity.</p>
<p>Empirically, our analysis using <code>distance_euclidean_rca</code> provides robust evidence for <strong>Asymmetric Trajectory Channeling</strong> across multiple specifications. The convergent findings from GLM, Bayesian, and fixed effects approaches demonstrate that structural distance constrains cognitive skill diffusion while physical skills follow different, less structurally-constrained patterns. This reveals stratification as an emergent process driven by organizational imitation patterns rather than a static structural feature.</p>
<p>Methodologically, we demonstrate how theoretically-grounded distance measures combined with piecewise regression and fixed effects estimation can resolve common econometric problems in diffusion studies while maintaining interpretability. The use of <code>distance_euclidean_rca</code> proves particularly valuable for capturing structural relationships in occupational space. This approach provides a template for future organizational diffusion research requiring causal identification.</p>
<p><strong>Policy Implications</strong>: Our findings suggest that interventions aimed at reducing labor market inequality should target the demand-side mechanisms that govern skill diffusion between organizations. Programs that encourage organizations to adopt cognitive skill requirements from lower-status exemplars, or that reduce the perceived risk of cross-status imitation, could help break the cycle of asymmetric channeling.</p>
<p><strong>Future Research</strong>: Subsequent work should examine the temporal dynamics of these fixed effects patterns, test our framework across different institutional contexts and time periods, and explore how technological change affects the structural distance measures that drive asymmetric channeling. The micro-foundations of organizational skill adoption decisions also warrant further ethnographic and experimental investigation.</p>
<hr>
<p><strong>Data Availability Statement</strong>: O*NET data is publicly available from the U.S. Department of Labor.</p>
<p><strong>Conflict of Interest</strong>: The authors declare no conflicts of interest.</p>
<p><strong>Funding</strong>: This research received no specific grant from any funding agency in the public, commercial, or not-for-profit sectors.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-alabdulkareem_unpacking_2018" class="csl-entry" role="listitem">
Alabdulkareem, Ahmad, Morgan R. Frank, Lijun Sun, Bedoor AlShebli, César Hidalgo, and Iyad Rahwan. 2018. <span>“Unpacking the Polarization of Workplace Skills.”</span> <em>Science Advances</em> 4 (7): eaao6030. <a href="https://doi.org/10.1126/sciadv.aao6030">https://doi.org/10.1126/sciadv.aao6030</a>.
</div>
<div id="ref-bail_prestige_2019" class="csl-entry" role="listitem">
Bail, Christopher A., Taylor W. Brown, and Andreas Wimmer. 2019. <span>“Prestige, Proximity, and Prejudice: How Google Search Terms Diffuse Across the World.”</span> <em>American Journal of Sociology</em> 124 (5): 1496–1548. <a href="https://doi.org/10.1086/702007">https://doi.org/10.1086/702007</a>.
</div>
<div id="ref-cyert_behavioral_2006" class="csl-entry" role="listitem">
Cyert, Richard Michael, Richard Michael Cyert, and James G. March. 2006. <em>A Behavioral Theory of the Firm</em>. 2. ed., [Nachdr.]. Malden, <span>MA</span>: Blackwell Publishing.
</div>
<div id="ref-dimaggio_iron_1983" class="csl-entry" role="listitem">
DiMaggio, Paul, and Walter Powell. 1983. <span>“The Iron Cage Revisited: Institutional Isomorphism and Collective Rationality in Organizational Fields.”</span> <em>American Sociological Review</em> 48 (2): 147–60. <a href="https://doi.org/10.2307/2095101">https://doi.org/10.2307/2095101</a>.
</div>
<div id="ref-hedstrom_contagious_1994" class="csl-entry" role="listitem">
Hedström, Peter. 1994. <span>“Contagious Collectivities: On the Spatial Diffusion of Swedish Trade Unions, 1890-1940.”</span> <em>American Journal of Sociology</em> 99 (5): 1157–79. <a href="https://doi.org/10.1086/230408">https://doi.org/10.1086/230408</a>.
</div>
<div id="ref-hosseinioun_skill_2025" class="csl-entry" role="listitem">
Hosseinioun, Moh, Frank Neffke, Letian Zhang, and Hyejin Youn. 2025. <span>“Skill Dependencies Uncover Nested Human Capital.”</span> <em>Nature Human Behaviour</em>, February. <a href="https://doi.org/10.1038/s41562-024-02093-2">https://doi.org/10.1038/s41562-024-02093-2</a>.
</div>
<div id="ref-strang_learning_2010" class="csl-entry" role="listitem">
Strang, David. 2010. <em>Learning by Example: Imitation and Innovation at a Global Bank</em>. Princeton: Princeton University Press.
</div>
<div id="ref-strang_search_2001" class="csl-entry" role="listitem">
Strang, David, and Michael W. Macy. 2001. <span>“In Search of Excellence: Fads, Success Stories, and Adaptive Emulation.”</span> <em>American Journal of Sociology</em> 107 (1): 147–82. <a href="https://doi.org/10.1086/323039">https://doi.org/10.1086/323039</a>.
</div>
<div id="ref-strang_institutional_1993" class="csl-entry" role="listitem">
Strang, David, and John W. Meyer. 1993. <span>“Institutional Conditions for Diffusion.”</span> <em>Theory and Society</em> 22 (4): 487–511. <a href="https://doi.org/10.1007/BF00993595">https://doi.org/10.1007/BF00993595</a>.
</div>
<div id="ref-strang_diffusion_1998" class="csl-entry" role="listitem">
Strang, David, and Sarah A. Soule. 1998. <span>“Diffusion in Organizations and Social Movements: From Hybrid Corn to Poison Pills.”</span> <em>Annual Review of Sociology</em> 24 (1): 265–90. <a href="https://doi.org/10.1146/annurev.soc.24.1.265">https://doi.org/10.1146/annurev.soc.24.1.265</a>.
</div>
<div id="ref-strang_spatial_1993" class="csl-entry" role="listitem">
Strang, David, and Nancy Brandon Tuma. 1993. <span>“Spatial and Temporal Heterogeneity in Diffusion.”</span> <em>American Journal of Sociology</em> 99 (3): 614–39. <a href="https://doi.org/10.1086/230318">https://doi.org/10.1086/230318</a>.
</div>
<div id="ref-york_gradationalism_2025" class="csl-entry" role="listitem">
York, Hunter, Xi Song, and Yu Xie. 2025. <span>“Gradationalism Revisited: Intergenerational Occupational Mobility Along Axes of Occupational Characteristics.”</span> <em>American Journal of Sociology</em> 130 (4): 976–1027. <a href="https://doi.org/10.1086/733122">https://doi.org/10.1086/733122</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/rcantillan\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024 Roberto Cantillan ∙ Made with <a href="https://quarto.org">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
<p><a class="link-dark me-1" href="../../../accessibility.html" title="Accessibility commitment" target="_blank" rel="noopener"><i class="fa-solid fa-universal-access" aria-label="universal-access"></i></a> <a class="link-dark me-1" href="" title="Substack" target="_blank" rel="noopener"><i class="bi-substack " style="" role="img" aria-hidden="true"></i></a> <a class="link-dark me-1" href="https://github.com/rcantillan" title="github" target="_blank" rel="noopener"><i class="fa-brands fa-github" aria-label="github"></i></a> <a class="link-dark me-1" href="https://cl.linkedin.com/in/roberto-cantillan-carrasco-67620517b" title="LinkedIn" target="_blank" rel="noopener"><i class="fa-brands fa-linkedin" aria-label="linkedin"></i></a> <a class="link-dark me-1" href="https://orcid.org/0000-0003-0494-0692;" title="orcid" target="_blank" rel="noopener"><i class="ai  ai-orcid" style="color:black"></i></a> <a class="link-dark me-1" href="https://scholar.google.com/citations?user=xZkAmvAAAAAJ&amp;hl=es" title="Google Scholar" target="_blank" rel="noopener"><i class="ai  ai-google-scholar" style="color:black"></i></a></p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../accessibility.qmd">
<p>Accessibility</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../contact.qmd">
<p>Contact</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="../../../license.qmd">
<p>License</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../../blog/index.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>